(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[624],{13986:function(e,t,o){"use strict";var a=o(13719),l=o.n(a),r=o(27454),n=o.n(r),s=o(76661),i=o(57695);const c=l().create({baseURL:s.c.baseURL,timeout:s.c.timeOut});c.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=n().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),c.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&i.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return i.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:i.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:i.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:i.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:i.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:i.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:i.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:i.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:i.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:i.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:i.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=c},42634:function(){},42999:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return z}});var a=o(74061),l=o(57695),r=o(13986),n=o(76661);const s={class:"user-list-container"},i={class:"row"},c={class:"col"},d={class:"col-2 text-right"},u=["src"],p={class:"text-subtitle2"},m={class:"q-mt-md flex justify-center items-center"},v={class:"text-h6"},V={class:"row justify-end q-gutter-sm"},C={class:"q-mb-md"},N={class:"row justify-end q-gutter-sm"};var f=(0,a.defineComponent)({__name:"index",setup(e){const t=(0,a.ref)(!1),o=(0,a.ref)(!1),f=(0,a.ref)(!1),w=(0,a.ref)(!1),h=(0,a.ref)([]),g=(0,a.ref)(""),x=(0,a.ref)({page:1,rowsPerPage:10,total:0}),b=(0,a.ref)(!1),k=(0,a.ref)(!1),A=(0,a.ref)({Username:"",Email:"",NickName:"",Avatar:"",IsAdmin:!1}),y=(0,a.ref)(null),_=(0,a.ref)(null),R=(0,a.ref)(""),q=async()=>{t.value=!0;try{const e={page:x.value.page,size:x.value.rowsPerPage,search:g.value||""},t=await r.A.get("/user/getusers",{params:e});t&&(h.value=t.Data||[],x.value.total=t.TotalCount||0)}catch(e){l.oR.error("加载数据失败",{autoClose:2e3,position:"top-center"})}finally{t.value=!1}},E=()=>{x.value.page=1,q()},U=(e=null)=>{A.value=e?{...e}:{Username:"",Email:"",NickName:"",Avatar:"",IsAdmin:!1},b.value=!0},P=()=>{b.value=!1,A.value={Username:"",Email:"",NickName:"",Avatar:"",IsAdmin:!1}},Q=async()=>{o.value=!0;try{const e=await r.A.post("/user/save",A.value);e?.Success?(l.oR.success(e.Message||"保存成功",{autoClose:2e3,position:"top-center"}),P(),await q()):l.oR.error(e?.Message||"保存失败",{autoClose:2e3,position:"top-center"})}catch(e){l.oR.error("保存失败",{autoClose:2e3,position:"top-center"})}finally{o.value=!1}},I=async()=>{f.value=!0;const e=await r.A.post(`/user/delete?id=${y.value.Id}`);l.oR.success(e?.Message||"删除成功",{autoClose:2e3,position:"top-center"}),await q(),f.value=!1},T=e=>{_.value=e,R.value="",k.value=!0},S=()=>{k.value=!1,_.value=null,R.value=""},M=async()=>{w.value=!0;try{const e=await r.A.post("/user/ResetPassword",{name:_.value?.Username,pwd:R.value});e?.Success?(l.oR.success(e.Message||"密码重置成功",{autoClose:2e3,position:"top-center"}),S()):l.oR.error(e?.Message||"密码重置失败",{autoClose:2e3,position:"top-center"})}catch(e){l.oR.error("密码重置失败",{autoClose:2e3,position:"top-center"})}finally{w.value=!1}};return(0,a.onMounted)(()=>{q()}),(e,l)=>{const r=(0,a.resolveComponent)("q-btn"),D=(0,a.resolveComponent)("q-btn-group"),j=(0,a.resolveComponent)("q-icon"),B=(0,a.resolveComponent)("q-input"),O=(0,a.resolveComponent)("q-avatar"),z=(0,a.resolveComponent)("vxe-column"),F=(0,a.resolveComponent)("q-chip"),L=(0,a.resolveComponent)("q-tooltip"),$=(0,a.resolveComponent)("q-card-section"),G=(0,a.resolveComponent)("q-card-actions"),H=(0,a.resolveComponent)("q-card"),J=(0,a.resolveComponent)("q-popup-proxy"),W=(0,a.resolveComponent)("vxe-table"),K=(0,a.resolveComponent)("q-pagination"),X=(0,a.resolveComponent)("q-select"),Y=(0,a.resolveComponent)("q-space"),Z=(0,a.resolveComponent)("q-toggle"),ee=(0,a.resolveComponent)("q-dialog"),te=(0,a.resolveDirective)("close-popup");return(0,a.openBlock)(),(0,a.createElementBlock)("div",s,[(0,a.createVNode)(H,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)($,null,{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",i,[(0,a.createElementVNode)("div",c,[(0,a.createVNode)(D,{push:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(r,{dense:"",color:"primary",icon:"add",onClick:l[0]||(l[0]=e=>U())},{default:(0,a.withCtx)(()=>[...l[11]||(l[11]=[(0,a.createTextVNode)(" 添加用户 ",-1)])]),_:1}),(0,a.createVNode)(r,{dense:"",color:"info",icon:"refresh",onClick:q,loading:t.value},{default:(0,a.withCtx)(()=>[...l[12]||(l[12]=[(0,a.createTextVNode)(" 刷新 ",-1)])]),_:1},8,["loading"])]),_:1})]),(0,a.createElementVNode)("div",d,[(0,a.createVNode)(B,{modelValue:g.value,"onUpdate:modelValue":[l[1]||(l[1]=e=>g.value=e),q],placeholder:"全局搜索",outlined:"",dense:"",clearable:"",class:"search-input",debounce:"500"},{prepend:(0,a.withCtx)(()=>[(0,a.createVNode)(j,{name:"search"})]),_:1},8,["modelValue"])])]),(0,a.createVNode)(W,{data:h.value,loading:t.value,stripe:"",border:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(z,{field:"Avatar",title:"头像",width:"80",fixed:"left"},{default:(0,a.withCtx)(({row:e})=>[e.Avatar?((0,a.openBlock)(),(0,a.createBlock)(O,{key:0,size:"40px"},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("img",{src:e.Avatar?.startsWith("http")?e.Avatar:(0,a.unref)(n.A).baseURL+e.Avatar},null,8,u)]),_:2},1024)):(0,a.createCommentVNode)("",!0)]),_:1}),(0,a.createVNode)(z,{field:"Username",title:"用户名","min-width":"120"}),(0,a.createVNode)(z,{field:"Email",title:"用户邮箱","min-width":"200"}),(0,a.createVNode)(z,{field:"NickName",title:"昵称","min-width":"120"}),(0,a.createVNode)(z,{field:"IsAdmin",title:"是否管理员",width:"120"},{default:(0,a.withCtx)(({row:e})=>[(0,a.createVNode)(F,{color:e.IsAdmin?"positive":"grey","text-color":"white",label:e.IsAdmin?"管理员":"普通用户",size:"sm"},null,8,["color","label"])]),_:1}),(0,a.createVNode)(z,{title:"操作",width:"180",fixed:"right"},{default:(0,a.withCtx)(({row:e})=>[(0,a.createVNode)(r,{dense:"",flat:"",color:"primary",icon:"edit",onClick:t=>U(e)},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(L,null,{default:(0,a.withCtx)(()=>[...l[13]||(l[13]=[(0,a.createTextVNode)("编辑",-1)])]),_:1})]),_:1},8,["onClick"]),(0,a.createVNode)(r,{dense:"",flat:"",color:"negative",icon:"delete"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(L,null,{default:(0,a.withCtx)(()=>[...l[14]||(l[14]=[(0,a.createTextVNode)("删除",-1)])]),_:1}),(0,a.createVNode)(J,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(H,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)($,{class:"row items-center"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(j,{name:"warning",color:"red",size:"2rem",class:"q-mr-sm"}),(0,a.createElementVNode)("div",null,[l[15]||(l[15]=(0,a.createElementVNode)("div",{class:"text-h6"},"确认删除",-1)),(0,a.createElementVNode)("div",p,"确认删除用户【"+(0,a.toDisplayString)(e.Username)+"】吗？",1)])]),_:2},1024),(0,a.createVNode)(G,{align:"right"},{default:(0,a.withCtx)(()=>[(0,a.withDirectives)((0,a.createVNode)(r,{flat:"",label:"确认",color:"negative",onClick:t=>{y.value=e,I()},loading:f.value},null,8,["onClick","loading"]),[[te]]),(0,a.withDirectives)((0,a.createVNode)(r,{flat:"",label:"取消",color:"primary"},null,512),[[te]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),(0,a.createVNode)(r,{dense:"",flat:"",color:"warning",icon:"lock_reset",onClick:t=>T(e)},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(L,null,{default:(0,a.withCtx)(()=>[...l[16]||(l[16]=[(0,a.createTextVNode)("重置密码",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","loading"]),(0,a.createElementVNode)("div",m,[(0,a.createVNode)(K,{modelValue:x.value.page,"onUpdate:modelValue":[l[2]||(l[2]=e=>x.value.page=e),q],max:Math.ceil(x.value.total/x.value.rowsPerPage),"direction-links":""},null,8,["modelValue","max"]),(0,a.createVNode)(X,{outlined:"",modelValue:x.value.rowsPerPage,"onUpdate:modelValue":[l[3]||(l[3]=e=>x.value.rowsPerPage=e),E],options:[10,15,20,30,50,100,200],dense:"",label:"每页"},null,8,["modelValue"])])]),_:1})]),_:1}),(0,a.createVNode)(ee,{modelValue:b.value,"onUpdate:modelValue":l[8]||(l[8]=e=>b.value=e),persistent:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(H,{style:{"min-width":"500px"}},{default:(0,a.withCtx)(()=>[(0,a.createVNode)($,{class:"row items-center q-pb-none"},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",v,(0,a.toDisplayString)(A.value?.Id?"编辑用户":"添加用户"),1),(0,a.createVNode)(Y),(0,a.createVNode)(r,{icon:"close",flat:"",round:"",dense:"",onClick:P})]),_:1}),(0,a.createVNode)($,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(B,{modelValue:A.value.Username,"onUpdate:modelValue":l[4]||(l[4]=e=>A.value.Username=e),label:"用户名",outlined:"",rules:[e=>!!e||"请输入用户名"]},null,8,["modelValue","rules"]),(0,a.createVNode)(B,{modelValue:A.value.NickName,"onUpdate:modelValue":l[5]||(l[5]=e=>A.value.NickName=e),label:"用户昵称",outlined:"",rules:[e=>!!e||"请输入用户昵称"]},null,8,["modelValue","rules"]),(0,a.createVNode)(B,{modelValue:A.value.Email,"onUpdate:modelValue":l[6]||(l[6]=e=>A.value.Email=e),label:"用户邮箱",outlined:"",type:"email",rules:[e=>!!e||"请输入用户邮箱",e=>/.+@.+\..+/.test(e)||"请输入正确的邮箱格式"]},null,8,["modelValue","rules"]),(0,a.createVNode)(Z,{modelValue:A.value.IsAdmin,"onUpdate:modelValue":l[7]||(l[7]=e=>A.value.IsAdmin=e),label:"管理员权限",color:"primary"},null,8,["modelValue"]),(0,a.createElementVNode)("div",V,[(0,a.createVNode)(r,{label:"取消",color:"grey",onClick:P}),(0,a.createVNode)(r,{label:"保存",type:"submit",color:"primary",loading:o.value,onClick:Q},null,8,["loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,a.createVNode)(ee,{modelValue:k.value,"onUpdate:modelValue":l[10]||(l[10]=e=>k.value=e),persistent:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(H,{style:{"min-width":"400px"}},{default:(0,a.withCtx)(()=>[(0,a.createVNode)($,{class:"row items-center q-pb-none"},{default:(0,a.withCtx)(()=>[l[17]||(l[17]=(0,a.createElementVNode)("div",{class:"text-h6"},"重置密码",-1)),(0,a.createVNode)(Y),(0,a.createVNode)(r,{icon:"close",flat:"",round:"",dense:"",onClick:S})]),_:1}),(0,a.createVNode)($,null,{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",C,[(0,a.createElementVNode)("strong",null,"用户："+(0,a.toDisplayString)(_.value?.Username),1)]),(0,a.createVNode)(B,{modelValue:R.value,"onUpdate:modelValue":l[9]||(l[9]=e=>R.value=e),label:"新密码",outlined:"",type:"password",rules:[e=>!!e||"请输入新密码",e=>e.length>=6||"密码长度至少6位"]},null,8,["modelValue","rules"]),(0,a.createElementVNode)("div",N,[(0,a.createVNode)(r,{label:"取消",color:"grey",onClick:S}),(0,a.createVNode)(r,{label:"确定",type:"submit",color:"primary",loading:w.value,onClick:M},null,8,["loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),w=o(1317),h=o(63663),g=o(17180),x=o(10258),b=o(20407),k=o(38622),A=o(64503),y=o(85515),_=o(97491),R=o(76997),q=o(34854),E=o(71248),U=o(74183),P=o(40975),Q=o(51375),I=o(25915),T=o(91343),S=o(45855),M=o(93483),D=o(60515),j=o(22110),B=o.n(j);const O=(0,w.A)(f,[["__scopeId","data-v-e177b6cc"]]);var z=O;B()(f,"components",{QCard:h.A,QCardSection:g.A,QBtnGroup:x.A,QBtn:b.A,QInput:k.A,QIcon:A.A,QAvatar:y.A,QChip:_.A,QTooltip:R.A,QPopupProxy:q.A,QCardActions:E.A,QPagination:U.A,QSelect:P.A,QDialog:Q.A,QSpace:I.A,QToggle:T.A,QField:S.A,QForm:M.A}),B()(f,"directives",{ClosePopup:D.A})}}]);