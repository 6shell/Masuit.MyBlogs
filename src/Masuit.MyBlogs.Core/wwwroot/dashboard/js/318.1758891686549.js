(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[318],{13986:function(e,l,a){"use strict";var o=a(74413),t=a(27454),s=a.n(t),u=a(76661),r=a(57695);const d=o.A.create({baseURL:u.c.baseURL,timeout:u.c.timeOut});d.interceptors.request.use(e=>{const l=sessionStorage.getItem("access_token");if(l&&(e.headers.Authorization="Bearer "+l),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=s().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),d.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&r.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return r.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:r.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:r.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:r.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:r.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:r.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:r.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:r.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:r.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:r.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:r.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),l.A=d},42634:function(){},81493:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return ge}});var o=a(74220),t=a(46732),s=a(57695),u=a(13986),r=(a(26960),a(243)),d=a(76661);const i={class:"system-settings-page"},n={class:"row"},c={class:"col text-right"},v={class:"row q-gutter-md q-mb-md"},m={class:"col"},p={class:"col"},b={class:"row q-gutter-md"},k={class:"col"},g={class:"col"},V={class:"row q-gutter-md"},L={class:"col"},f={class:"col"},y={class:"col"},R={class:"row q-mb-md"},F={class:"col"},h={class:"col"},C={class:"col"},S={class:"row q-mb-md"},w={class:"col"},E={class:"col"},U={class:"row q-gutter-md q-mb-md"},q={class:"col"},x={class:"row q-gutter-md"},_={class:"col"},A={class:"col"},T={key:0},W={key:1},P={key:0,class:"col"},D={class:"col"},M={key:0,class:"row"},Q={class:"row q-gutter-md q-mb-md"},O={class:"col"},N={class:"col"},I={class:"row q-gutter-md"},K={class:"col"},j={class:"row q-gutter-md q-mb-md"},z={class:"col"},B={class:"col"},X={class:"col"},H={class:"col"},J={class:"row q-gutter-md"},$={class:"col"},G={class:"col"},Y={class:"row q-gutter-md"},Z={class:"col-2"},ee={class:"col-12"},le={class:"col-12"};var ae=(0,o.pM)({__name:"settings",setup(e){const l=(0,t.KR)({}),a=(0,t.KR)(!1),ae=(0,t.KR)(!1),oe=(0,t.KR)(!1),te=(0,t.KR)(!1),se=(0,t.KR)(null),ue=(0,t.KR)(""),re=(0,t.KR)(),de=(0,t.KR)();let ie=null,ne=null;const ce=[{label:"无水印",value:"None"},{label:"文字水印",value:"Text"},{label:"图片水印",value:"Image"}],ve=(0,o.EW)({get:()=>"true"===l.value.EnableRss,set:e=>{l.value.EnableRss=e?"true":"false"}}),me=(0,o.EW)({get:()=>"true"===l.value.EnableDonate,set:e=>{l.value.EnableDonate=e?"true":"false"}}),pe=(0,o.EW)({get:()=>"true"===l.value.CloseSite,set:e=>{l.value.CloseSite=e?"true":"false"}}),be=(0,o.EW)({get:()=>"true"===l.value.DataReadonly,set:e=>{l.value.DataReadonly=e?"true":"false"}}),ke=(0,o.EW)({get:()=>"true"===l.value.EnableSsl,set:e=>{l.value.EnableSsl=e?"true":"false"}}),ge=async()=>{const e=await u.A.get("/system/getsettings");if(e?.Success&&e.Data){const a={};e.Data.forEach(e=>{a[e.Name]=e.Value}),l.value=a,ie&&ie.setValue(l.value.Styles||""),ne&&ne.setValue(l.value.Scripts||"")}else s.oR.error("获取系统设置失败",{autoClose:2e3,position:"top-center"})},Ve=async()=>{a.value=!0,ie&&(l.value.Styles=ie.getValue()),ne&&(l.value.Scripts=ne.getValue());const e=await u.A.post("/system/save",Object.keys(l.value).map(e=>({Name:e,Value:l.value[e]})));e?.Success?s.oR.success(e.Message||"保存成功",{autoClose:2e3,position:"top-center"}):s.oR.error(e?.Message||"保存失败",{autoClose:2e3,position:"top-center"}),a.value=!1},Le=async()=>{ae.value=!0;try{const e=await u.A.post("/system/mailtest",{smtp:l.value.SMTP,user:l.value.EmailFrom,pwd:l.value.EmailPwd,port:l.value.SmtpPort,to:l.value.ReceiveEmail,ssl:ke.value});e?.Success?s.oR.success("邮件发送成功",{autoClose:2e3,position:"top-center"}):s.oR.error(e?.Message||"邮件发送失败",{autoClose:2e3,position:"top-center"})}catch(e){s.oR.error("邮件发送失败",{autoClose:2e3,position:"top-center"}),console.error("Error testing email:",e)}finally{ae.value=!1}},fe=async()=>{try{const e=await u.A.post("/system/pathtest",{path:l.value.PathRoot});e?.Success?s.oR.success("路径测试成功",{autoClose:2e3,position:"top-center"}):s.oR.error(e?.Message||"路径测试失败",{autoClose:2e3,position:"top-center"})}catch(e){s.oR.error("路径测试失败",{autoClose:2e3,position:"top-center"}),console.error("Error testing path:",e)}},ye=e=>{ue.value=e,te.value=!0},Re=()=>{te.value=!1,se.value=null,ue.value=""},Fe=async()=>{if(se.value){oe.value=!0;try{const e=new FormData;e.append("file",se.value);const a=await u.A.post("/Upload",e,{headers:{"Content-Type":"multipart/form-data"}});a?.Success&&a.Data?(l.value[ue.value]=a.Data,s.oR.success("图片上传成功",{autoClose:2e3,position:"top-center"}),Re()):s.oR.error(a?.Message||"图片上传失败",{autoClose:2e3,position:"top-center"})}catch(e){s.oR.error("图片上传失败",{autoClose:2e3,position:"top-center"}),console.error("Error uploading image:",e)}finally{oe.value=!1}}else s.oR.error("请选择图片文件",{autoClose:2e3,position:"top-center"})},he=()=>{re.value&&(ie=r.EN.create(re.value,{value:l.value.Styles||"",language:"css",theme:"vs",minimap:{enabled:!1},scrollBeyondLastLine:!1})),de.value&&(ne=r.EN.create(de.value,{value:l.value.Scripts||"",language:"javascript",theme:"vs",minimap:{enabled:!1},scrollBeyondLastLine:!1}))};return(0,o.sV)(async()=>{await ge(),setTimeout(he,100)}),(0,o.hi)(()=>{ie&&ie.dispose(),ne&&ne.dispose()}),(e,s)=>{const u=(0,o.g2)("q-btn"),r=(0,o.g2)("q-input"),ue=(0,o.g2)("q-checkbox"),ie=(0,o.g2)("q-select"),ne=(0,o.g2)("q-img"),ge=(0,o.g2)("q-card-section"),he=(0,o.g2)("q-card"),Ce=(0,o.g2)("vue-ueditor-wrap"),Se=(0,o.g2)("q-file"),we=(0,o.g2)("q-card-actions"),Ee=(0,o.g2)("q-dialog");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.Lk)("div",n,[(0,o.Lk)("div",c,[(0,o.bF)(u,{color:"primary",size:"lg",icon:"save",label:"保存配置",onClick:Ve,loading:a.value},null,8,["loading"])])]),(0,o.bF)(he,{flat:"",bordered:""},{default:(0,o.k6)(()=>[(0,o.bF)(ge,null,{default:(0,o.k6)(()=>[s[34]||(s[34]=(0,o.Lk)("div",{class:"text-h6 q-mb-md"},"基础配置",-1)),(0,o.Lk)("div",v,[(0,o.Lk)("div",m,[(0,o.bF)(r,{modelValue:l.value.Domain,"onUpdate:modelValue":s[0]||(s[0]=e=>l.value.Domain=e),label:"网站主域名",outlined:"",dense:""},null,8,["modelValue"])]),(0,o.Lk)("div",p,[(0,o.bF)(r,{modelValue:l.value.Title,"onUpdate:modelValue":s[1]||(s[1]=e=>l.value.Title=e),label:"网站标语",outlined:"",dense:""},null,8,["modelValue"])])]),(0,o.Lk)("div",b,[(0,o.Lk)("div",k,[(0,o.bF)(r,{modelValue:l.value.Slogan,"onUpdate:modelValue":s[2]||(s[2]=e=>l.value.Slogan=e),label:"网站口号",outlined:"",dense:""},null,8,["modelValue"])]),(0,o.Lk)("div",g,[(0,o.bF)(r,{modelValue:l.value.ReservedName,"onUpdate:modelValue":s[3]||(s[3]=e=>l.value.ReservedName=e),label:"保留关键字",outlined:"",dense:"",hint:"用逗号分隔多个关键字"},null,8,["modelValue"])])]),(0,o.Lk)("div",V,[(0,o.Lk)("div",L,[(0,o.bF)(r,{modelValue:l.value.PathRoot,"onUpdate:modelValue":s[4]||(s[4]=e=>l.value.PathRoot=e),label:"资源管理器根目录",outlined:"",dense:""},{append:(0,o.k6)(()=>[(0,o.bF)(u,{flat:"",round:"",dense:"",icon:"folder",onClick:fe})]),_:1},8,["modelValue"])]),(0,o.Lk)("div",f,[(0,o.bF)(r,{modelValue:l.value.UploadPath,"onUpdate:modelValue":s[5]||(s[5]=e=>l.value.UploadPath=e),label:"文件上传目录",outlined:"",dense:""},null,8,["modelValue"])]),(0,o.Lk)("div",y,[(0,o.Lk)("div",R,[(0,o.Lk)("div",F,[(0,o.bF)(ue,{modelValue:ve.value,"onUpdate:modelValue":s[6]||(s[6]=e=>ve.value=e),label:"启用RSS"},null,8,["modelValue"])]),(0,o.Lk)("div",h,[(0,o.bF)(ue,{modelValue:me.value,"onUpdate:modelValue":s[7]||(s[7]=e=>me.value=e),label:"启用网站打赏功能"},null,8,["modelValue"])])])]),(0,o.Lk)("div",C,[(0,o.Lk)("div",S,[(0,o.Lk)("div",w,[(0,o.bF)(ue,{modelValue:pe.value,"onUpdate:modelValue":s[8]||(s[8]=e=>pe.value=e),label:"闭站保护"},null,8,["modelValue"])]),(0,o.Lk)("div",E,[(0,o.bF)(ue,{modelValue:be.value,"onUpdate:modelValue":s[9]||(s[9]=e=>be.value=e),label:"数据写保护"},null,8,["modelValue"])])])])]),(0,o.Lk)("div",U,[(0,o.Lk)("div",q,[(0,o.Lk)("div",x,[(0,o.Lk)("div",_,[(0,o.bF)(ie,{modelValue:l.value.WatermarkType,"onUpdate:modelValue":s[10]||(s[10]=e=>l.value.WatermarkType=e),options:ce,label:"水印类型",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue"])]),(0,o.Lk)("div",A,["Text"==l.value.WatermarkType?((0,o.uX)(),(0,o.CE)("div",T,[(0,o.bF)(r,{autogrow:"",dense:"",outlined:"",modelValue:l.value.Watermark,"onUpdate:modelValue":s[11]||(s[11]=e=>l.value.Watermark=e),placeholder:"留空则上传图片时不添加水印"},null,8,["modelValue"])])):(0,o.Q3)("",!0),"Image"==l.value.WatermarkType?((0,o.uX)(),(0,o.CE)("div",W,[(0,o.bF)(ne,{src:l.value.WatermarkImage?.startsWith("http")?l.value.WatermarkImage:(0,t.R1)(d.A).baseURL+l.value.WatermarkImage,"spinner-color":"white",onClick:s[12]||(s[12]=e=>ye("WatermarkImage")),bordered:"",class:"logo-preview cursor-pointer",style:{"max-height":"200px",border:"1px dashed #ccc"}},null,8,["src"]),(0,o.bF)(u,{color:"primary",onClick:s[13]||(s[13]=e=>ye("WatermarkImage")),label:"上传"})])):(0,o.Q3)("",!0)]),"None"!=l.value.WatermarkType?((0,o.uX)(),(0,o.CE)("div",P,[(0,o.bF)(ie,{modelValue:l.value.WatermarkPosition,"onUpdate:modelValue":s[14]||(s[14]=e=>l.value.WatermarkPosition=e),options:[{label:"左上角",value:"0"},{label:"右上角",value:"1"},{label:"左下角",value:"2"},{label:"右下角",value:"3"},{label:"中间",value:"4"}],outlined:"",dense:"","emit-value":"","map-options":"",label:"水印位置："},null,8,["modelValue"])])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",D,[ve.value?((0,o.uX)(),(0,o.CE)("div",M,[(0,o.bF)(ie,{class:"col-auto",modelValue:l.value.RssStart,"onUpdate:modelValue":s[15]||(s[15]=e=>l.value.RssStart=e),options:[{label:"1天前",value:"-1"},{label:"2天前",value:"-2"},{label:"3天前",value:"-3"},{label:"4天前",value:"-4"},{label:"5天前",value:"-5"}],dense:"","emit-value":"","map-options":"",borderless:""},{prepend:(0,o.k6)(()=>[...s[32]||(s[32]=[(0,o.Lk)("span",{style:{"font-size":"14px"}}," RSS订阅从 ",-1)])]),_:1},8,["modelValue"]),(0,o.bF)(ie,{class:"col-auto",modelValue:l.value.RssEnd,"onUpdate:modelValue":s[16]||(s[16]=e=>l.value.RssEnd=e),options:[{label:"现在",value:"0"},{label:"2小时前",value:"-2"},{label:"5小时前",value:"-5"},{label:"12小时前",value:"-12"},{label:"1天前",value:"-24"},{label:"2天前",value:"-48"}],dense:"","emit-value":"","map-options":"",borderless:""},{prepend:(0,o.k6)(()=>[...s[33]||(s[33]=[(0,o.Lk)("span",{style:{"font-size":"14px"}}," 到 ",-1)])]),_:1},8,["modelValue"])])):(0,o.Q3)("",!0)])])]),_:1})]),_:1}),(0,o.bF)(he,{flat:"",bordered:""},{default:(0,o.k6)(()=>[(0,o.bF)(ge,null,{default:(0,o.k6)(()=>[s[37]||(s[37]=(0,o.Lk)("div",{class:"text-h6"},"自定义脚本和样式",-1)),(0,o.Lk)("div",null,[s[35]||(s[35]=(0,o.Lk)("div",{class:"text-subtitle1"},"CSS样式代码：",-1)),(0,o.Lk)("div",{ref_key:"stylesEditor",ref:re,class:"editor-container",style:{height:"200px"}},null,512)]),(0,o.Lk)("div",null,[s[36]||(s[36]=(0,o.Lk)("div",{class:"text-subtitle1 q-mb-sm"},"JS脚本代码：",-1)),(0,o.Lk)("div",{ref_key:"scriptsEditor",ref:de,class:"editor-container",style:{height:"400px"}},null,512)])]),_:1})]),_:1}),(0,o.bF)(he,{flat:"",bordered:""},{default:(0,o.k6)(()=>[(0,o.bF)(ge,null,{default:(0,o.k6)(()=>[s[38]||(s[38]=(0,o.Lk)("div",{class:"text-h6"},"网站SEO相关",-1)),(0,o.Lk)("div",Q,[(0,o.Lk)("div",O,[(0,o.bF)(r,{modelValue:l.value.Title,"onUpdate:modelValue":s[17]||(s[17]=e=>l.value.Title=e),label:"SEO标题",outlined:"",dense:""},null,8,["modelValue"])]),(0,o.Lk)("div",N,[(0,o.bF)(r,{modelValue:l.value.Keyword,"onUpdate:modelValue":s[18]||(s[18]=e=>l.value.Keyword=e),label:"SEO关键词",outlined:"",dense:""},null,8,["modelValue"])])]),(0,o.Lk)("div",I,[(0,o.Lk)("div",K,[(0,o.bF)(r,{modelValue:l.value.Description,"onUpdate:modelValue":s[19]||(s[19]=e=>l.value.Description=e),label:"SEO描述",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])])])]),_:1})]),_:1}),(0,o.bF)(he,{flat:"",bordered:""},{default:(0,o.k6)(()=>[(0,o.bF)(ge,null,{default:(0,o.k6)(()=>[s[39]||(s[39]=(0,o.Lk)("div",{class:"text-h6"},"网站邮箱配置",-1)),(0,o.Lk)("div",j,[(0,o.Lk)("div",z,[(0,o.bF)(r,{modelValue:l.value.EmailFrom,"onUpdate:modelValue":s[20]||(s[20]=e=>l.value.EmailFrom=e),label:"发件邮箱",outlined:"",dense:"",type:"email"},null,8,["modelValue"])]),(0,o.Lk)("div",B,[(0,o.bF)(r,{modelValue:l.value.EmailPwd,"onUpdate:modelValue":s[21]||(s[21]=e=>l.value.EmailPwd=e),label:"发件邮箱密码",outlined:"",dense:"",type:"password"},null,8,["modelValue"])]),(0,o.Lk)("div",X,[(0,o.bF)(r,{modelValue:l.value.SMTP,"onUpdate:modelValue":s[22]||(s[22]=e=>l.value.SMTP=e),label:"SMTP服务器",outlined:"",dense:""},null,8,["modelValue"])]),(0,o.Lk)("div",H,[(0,o.bF)(r,{modelValue:l.value.SmtpPort,"onUpdate:modelValue":s[23]||(s[23]=e=>l.value.SmtpPort=e),label:"SMTP端口号",outlined:"",dense:"",type:"number"},null,8,["modelValue"])])]),(0,o.Lk)("div",J,[(0,o.Lk)("div",$,[(0,o.bF)(ue,{modelValue:ke.value,"onUpdate:modelValue":s[24]||(s[24]=e=>ke.value=e),label:"启用SSL加密"},null,8,["modelValue"])]),(0,o.Lk)("div",G,[(0,o.bF)(r,{modelValue:l.value.ReceiveEmail,"onUpdate:modelValue":s[25]||(s[25]=e=>l.value.ReceiveEmail=e),label:"接收网站通知邮箱",outlined:"",dense:"",type:"email"},{append:(0,o.k6)(()=>[(0,o.bF)(u,{dense:"",color:"info",label:"测试发送",onClick:Le,loading:ae.value},null,8,["loading"])]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),(0,o.bF)(he,{flat:"",bordered:""},{default:(0,o.k6)(()=>[(0,o.bF)(ge,null,{default:(0,o.k6)(()=>[s[43]||(s[43]=(0,o.Lk)("div",{class:"text-h6"},"网站媒体设置",-1)),(0,o.Lk)("div",Y,[(0,o.Lk)("div",Z,[s[40]||(s[40]=(0,o.Lk)("div",{class:"text-subtitle1"},"网站Logo：",-1)),(0,o.bF)(ne,{src:l.value.logo?.startsWith("http")?l.value.logo:(0,t.R1)(d.A).baseURL+l.value.logo,class:"logo-preview cursor-pointer",onClick:s[26]||(s[26]=e=>ye("logo")),style:{"max-height":"200px",border:"1px dashed #ccc"}},null,8,["src"]),(0,o.bF)(u,{flat:"",size:"sm",label:"选择图片",onClick:s[27]||(s[27]=e=>ye("logo")),class:"full-width q-mt-sm"})]),(0,o.Lk)("div",ee,[s[41]||(s[41]=(0,o.Lk)("div",{class:"text-subtitle1"},"文章版权声明：",-1)),(0,o.bF)(Ce,{modelValue:l.value.Disclaimer,"onUpdate:modelValue":s[28]||(s[28]=e=>l.value.Disclaimer=e),config:{initialFrameHeight:200,initialFrameWidth:"100%"}},null,8,["modelValue"])]),(0,o.Lk)("div",le,[s[42]||(s[42]=(0,o.Lk)("div",{class:"text-subtitle1"},"网站页脚版权：",-1)),(0,o.bF)(Ce,{modelValue:l.value.Copyright,"onUpdate:modelValue":s[29]||(s[29]=e=>l.value.Copyright=e),config:{initialFrameHeight:120,initialFrameWidth:"100%"}},null,8,["modelValue"])])])]),_:1})]),_:1}),(0,o.bF)(Ee,{modelValue:te.value,"onUpdate:modelValue":s[31]||(s[31]=e=>te.value=e),persistent:""},{default:(0,o.k6)(()=>[(0,o.bF)(he,{style:{"min-width":"400px"}},{default:(0,o.k6)(()=>[(0,o.bF)(ge,null,{default:(0,o.k6)(()=>[...s[44]||(s[44]=[(0,o.Lk)("div",{class:"text-h6"},"上传图片",-1)])]),_:1}),(0,o.bF)(ge,null,{default:(0,o.k6)(()=>[(0,o.bF)(Se,{modelValue:se.value,"onUpdate:modelValue":s[30]||(s[30]=e=>se.value=e),label:"选择图片文件",outlined:"",accept:"image/*"},null,8,["modelValue"])]),_:1}),(0,o.bF)(we,{align:"right"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{flat:"",label:"取消",color:"grey",onClick:Re}),(0,o.bF)(u,{flat:"",label:"上传",color:"primary",onClick:Fe,loading:oe.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),oe=a(1317),te=a(20407),se=a(63663),ue=a(17180),re=a(38622),de=a(78495),ie=a(40975),ne=a(45678),ce=a(51375),ve=a(61929),me=a(71248),pe=a(22110),be=a.n(pe);const ke=(0,oe.A)(ae,[["__scopeId","data-v-cc57edd4"]]);var ge=ke;be()(ae,"components",{QBtn:te.A,QCard:se.A,QCardSection:ue.A,QInput:re.A,QCheckbox:de.A,QSelect:ie.A,QImg:ne.A,QDialog:ce.A,QFile:ve.A,QCardActions:me.A})}}]);