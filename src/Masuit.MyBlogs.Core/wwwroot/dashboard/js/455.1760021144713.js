(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[455],{9762:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return de}});var l=o(74061),a=o(57695),r=o(13986),s=o(23508),n=o.n(s);const c={class:"sendbox-page"},i={class:"row q-mb-md"},d={class:"col text-right"},u={class:"text-h6 q-mb-md"},m={key:0,class:"text-center q-pa-xl text-grey-6"},p={key:1},v={class:"row items-center justify-between q-mb-md"},V={class:"col-auto"},N={class:"text-body2 text-grey-7"},C={class:"col-auto"},x={class:"row q-gutter-md"},h={class:"row items-start q-gutter-md"},g={class:"col-auto"},f={class:"col"},b={class:"text-h6 text-weight-bold q-mb-xs"},w=["innerHTML"],y={class:"row q-gutter-md text-body2 text-grey-6"},k={class:"col-auto"},E={class:"col-auto"},q={class:"col-auto"},A=["href"],_={class:"col-auto"},R={key:0,class:"row justify-center q-mt-md"},B={class:"q-gutter-md"},S={class:"q-gutter-md"},D={class:"row"},T={class:"col-10"},Q={class:"row"},M={class:"col-10"},P={class:"row"},U={class:"col-10"},L={class:"row"},H={class:"col-10"},O=["innerHTML"];var j=(0,l.defineComponent)({__name:"sendbox",setup(e){const t=(0,l.ref)([]),o=(0,l.ref)(!1),s=(0,l.ref)(!1),j=(0,l.ref)(1),I=(0,l.ref)(10),z=[{label:"5条/页",value:5},{label:"10条/页",value:10},{label:"20条/页",value:20},{label:"50条/页",value:50}],F=(0,l.ref)(!1),Y=(0,l.ref)(!1),$=(0,l.ref)({tos:"",title:"",content:""}),G=(0,l.ref)(null),J=(0,l.computed)(()=>Math.ceil(t.value.length/I.value)),W=(0,l.computed)(()=>{const e=(j.value-1)*I.value,o=e+I.value;return t.value.slice(e,o)}),K=e=>{j.value=e},X=e=>{I.value=e,j.value=1},Z=async()=>{o.value=!0;try{const e=await r.A.get("/system/sendbox");Array.isArray(e)?t.value=e:t.value=[]}catch(e){a.oR.error("加载邮件列表失败",{autoClose:2e3,position:"top-center"}),console.error("Error loading mails:",e),t.value=[]}finally{o.value=!1}},ee=()=>{$.value={tos:"",title:"",content:""},F.value=!0},te=()=>{F.value=!1},oe=async()=>{if($.value.tos&&$.value.title){s.value=!0;try{const e=await r.A.post("/system/sendmail",$.value);!1!==e?.Success?(a.oR.success("邮件发送成功",{autoClose:2e3,position:"top-center"}),te(),setTimeout(()=>{Z()},500)):a.oR.error(e?.Message||"邮件发送失败",{autoClose:2e3,position:"top-center"})}catch(e){a.oR.error("邮件发送失败",{autoClose:2e3,position:"top-center"}),console.error("Error sending mail:",e)}finally{s.value=!1}}else a.oR.warning("请填写完整的邮件信息",{autoClose:2e3,position:"top-center"})},le=e=>{G.value=e,Y.value=!0},ae=async e=>{const t=await r.A.post("/system/AddToBlackList",{ip:e});a.oR.success(t?.Message||"已加入黑名单",{autoClose:2e3,position:"top-center"})},re=e=>n()(e).format("YYYY-MM-DD HH:mm:ss");return(0,l.onMounted)(()=>{Z()}),(e,a)=>{const r=(0,l.resolveComponent)("q-btn"),n=(0,l.resolveComponent)("q-btn-group"),se=(0,l.resolveComponent)("q-icon"),ne=(0,l.resolveComponent)("q-chip"),ce=(0,l.resolveComponent)("q-select"),ie=(0,l.resolveComponent)("q-avatar"),de=(0,l.resolveComponent)("q-tooltip"),ue=(0,l.resolveComponent)("q-card-section"),me=(0,l.resolveComponent)("q-card-actions"),pe=(0,l.resolveComponent)("q-card"),ve=(0,l.resolveComponent)("q-popup-proxy"),Ve=(0,l.resolveComponent)("q-pagination"),Ne=(0,l.resolveComponent)("q-space"),Ce=(0,l.resolveComponent)("q-input"),xe=(0,l.resolveComponent)("vue-ueditor-wrap"),he=(0,l.resolveComponent)("q-dialog"),ge=(0,l.resolveComponent)("q-separator"),fe=(0,l.resolveDirective)("close-popup");return(0,l.openBlock)(),(0,l.createElementBlock)("div",c,[(0,l.createElementVNode)("div",i,[a[9]||(a[9]=(0,l.createElementVNode)("div",{class:"col text-h6"}," 发件箱管理 ",-1)),(0,l.createElementVNode)("div",d,[(0,l.createVNode)(n,null,{default:(0,l.withCtx)(()=>[(0,l.createVNode)(r,{color:"primary",icon:"refresh",label:"刷新",onClick:Z,loading:o.value},null,8,["loading"]),(0,l.createVNode)(r,{color:"positive",icon:"add",label:"新建邮件",onClick:ee})]),_:1})])]),(0,l.createVNode)(pe,{flat:"",bordered:""},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(ue,null,{default:(0,l.withCtx)(()=>[(0,l.createElementVNode)("div",u,[(0,l.createVNode)(se,{name:"outgoing_mail",class:"q-mr-sm"}),a[10]||(a[10]=(0,l.createTextVNode)(" 邮件列表 ",-1)),t.value.length>0?((0,l.openBlock)(),(0,l.createBlock)(ne,{key:0,color:"primary","text-color":"white",label:`共 ${t.value.length} 封邮件`,class:"q-ml-sm"},null,8,["label"])):(0,l.createCommentVNode)("",!0)]),0!==t.value.length||o.value?((0,l.openBlock)(),(0,l.createElementBlock)("div",p,[(0,l.createElementVNode)("div",v,[(0,l.createElementVNode)("div",V,[(0,l.createElementVNode)("span",N," 共 "+(0,l.toDisplayString)(t.value.length)+" 条记录，当前显示第 "+(0,l.toDisplayString)((j.value-1)*I.value+1)+" - "+(0,l.toDisplayString)(Math.min(j.value*I.value,t.value.length))+" 条 ",1)]),(0,l.createElementVNode)("div",C,[(0,l.createVNode)(ce,{modelValue:I.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>I.value=e),X],options:z,dense:"",outlined:"",label:"每页显示",style:{"min-width":"120px"}},null,8,["modelValue"])])]),(0,l.createElementVNode)("div",x,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(W.value,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)("div",{key:t,class:"col-12"},[(0,l.createVNode)(pe,{class:"mail-card",flat:"",bordered:""},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(ue,null,{default:(0,l.withCtx)(()=>[(0,l.createElementVNode)("div",h,[(0,l.createElementVNode)("div",g,[(0,l.createVNode)(ie,{color:"primary","text-color":"white",icon:"mail",size:"48px"})]),(0,l.createElementVNode)("div",f,[(0,l.createElementVNode)("div",b,(0,l.toDisplayString)(e.title||"无标题"),1),(0,l.createElementVNode)("div",{class:"text-body2 text-grey-7 q-mb-md mail-content",innerHTML:e.content},null,8,w),(0,l.createElementVNode)("div",y,[(0,l.createElementVNode)("div",k,[(0,l.createVNode)(se,{name:"person",class:"q-mr-xs"}),(0,l.createTextVNode)(" 收件人："+(0,l.toDisplayString)(e.tos),1)]),(0,l.createElementVNode)("div",E,[(0,l.createVNode)(se,{name:"schedule",class:"q-mr-xs"}),(0,l.createTextVNode)(" 发送时间："+(0,l.toDisplayString)(re(e.time)),1)]),(0,l.createElementVNode)("div",q,[(0,l.createVNode)(se,{name:"computer",class:"q-mr-xs"}),a[15]||(a[15]=(0,l.createTextVNode)(" 请求IP： ",-1)),(0,l.createElementVNode)("a",{href:`/tools/ip/${e.clientip}`,target:"_blank",class:"text-primary"},(0,l.toDisplayString)(e.clientip),9,A),(0,l.createVNode)(r,{color:"negative",icon:"block",dense:"",flat:"",size:"sm",class:"q-ml-sm"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(de,null,{default:(0,l.withCtx)(()=>[...a[13]||(a[13]=[(0,l.createTextVNode)("添加到黑名单",-1)])]),_:1}),(0,l.createVNode)(ve,{breakpoint:"","transition-show":"scale","transition-hide":"scale"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(pe,null,{default:(0,l.withCtx)(()=>[(0,l.createVNode)(ue,{class:"row items-center"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(se,{name:"warning",color:"red",size:"2rem",class:"q-mr-sm"}),a[14]||(a[14]=(0,l.createElementVNode)("div",null,[(0,l.createElementVNode)("div",{class:"text-h6"},"确认操作"),(0,l.createElementVNode)("div",{class:"text-subtitle2"},"此操作将标记该用户IP为黑名单，是否继续？")],-1))]),_:1}),(0,l.createVNode)(me,{align:"right"},{default:(0,l.withCtx)(()=>[(0,l.withDirectives)((0,l.createVNode)(r,{flat:"",label:"确认",color:"negative",onClick:t=>ae(e.clientip)},null,8,["onClick"]),[[fe]]),(0,l.withDirectives)((0,l.createVNode)(r,{flat:"",label:"取消",color:"primary"},null,512),[[fe]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)])])]),(0,l.createElementVNode)("div",_,[(0,l.createVNode)(r,{color:"info",icon:"visibility",flat:"",round:"",onClick:t=>le(e)},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(de,null,{default:(0,l.withCtx)(()=>[...a[16]||(a[16]=[(0,l.createTextVNode)("查看详情",-1)])]),_:1})]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024)]))),128))]),J.value>1?((0,l.openBlock)(),(0,l.createElementBlock)("div",R,[(0,l.createVNode)(Ve,{modelValue:j.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>j.value=e),K],max:J.value,"max-pages":6,"direction-links":"","boundary-links":"",color:"primary"},null,8,["modelValue","max"])])):(0,l.createCommentVNode)("",!0)])):((0,l.openBlock)(),(0,l.createElementBlock)("div",m,[(0,l.createVNode)(se,{name:"mail_outline",size:"64px",class:"q-mb-md"}),a[11]||(a[11]=(0,l.createElementVNode)("div",{class:"text-h6"},"暂无邮件记录",-1)),a[12]||(a[12]=(0,l.createElementVNode)("div",{class:"text-body2 q-mt-sm"},'点击上方"新建邮件"按钮发送第一封邮件',-1))]))]),_:1})]),_:1}),(0,l.createVNode)(he,{modelValue:F.value,"onUpdate:modelValue":a[5]||(a[5]=e=>F.value=e),persistent:""},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(pe,{style:{"min-width":"800px","max-width":"75vw"}},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(ue,{class:"row items-center q-pb-none"},{default:(0,l.withCtx)(()=>[a[17]||(a[17]=(0,l.createElementVNode)("div",{class:"text-h6"},"发送邮件",-1)),(0,l.createVNode)(Ne),(0,l.createVNode)(r,{icon:"close",flat:"",round:"",dense:"",onClick:te})]),_:1}),(0,l.createVNode)(ue,null,{default:(0,l.withCtx)(()=>[(0,l.createElementVNode)("div",B,[(0,l.createVNode)(Ce,{modelValue:$.value.tos,"onUpdate:modelValue":a[2]||(a[2]=e=>$.value.tos=e),label:"收件人",hint:"多个邮箱用逗号分隔",dense:"",outlined:"",required:"",rules:[e=>!!e||"请输入收件人"]},null,8,["modelValue","rules"]),(0,l.createVNode)(Ce,{modelValue:$.value.title,"onUpdate:modelValue":a[3]||(a[3]=e=>$.value.title=e),label:"邮件标题",dense:"",outlined:"",required:"",rules:[e=>!!e||"请输入邮件标题"]},null,8,["modelValue","rules"]),a[18]||(a[18]=(0,l.createElementVNode)("div",{class:"text-subtitle2"},"邮件内容：",-1)),(0,l.createVNode)(xe,{modelValue:$.value.content,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value.content=e),config:{initialFrameHeight:200,initialFrameWidth:"100%"}},null,8,["modelValue"])])]),_:1}),(0,l.createVNode)(me,{align:"right"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(r,{flat:"",label:"取消",onClick:te}),(0,l.createVNode)(r,{icon:"send",color:"primary",label:"发送",onClick:oe,loading:s.value,disable:!$.value.tos||!$.value.title},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.createVNode)(he,{modelValue:Y.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Y.value=e)},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(pe,{style:{"min-width":"700px","max-width":"90vw"}},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(ue,{class:"row items-center q-pb-none"},{default:(0,l.withCtx)(()=>[a[19]||(a[19]=(0,l.createElementVNode)("div",{class:"text-h6"},"邮件详情",-1)),(0,l.createVNode)(Ne),(0,l.createVNode)(r,{icon:"close",flat:"",round:"",dense:"",onClick:a[6]||(a[6]=e=>Y.value=!1)})]),_:1}),G.value?((0,l.openBlock)(),(0,l.createBlock)(ue,{key:0},{default:(0,l.withCtx)(()=>[(0,l.createElementVNode)("div",S,[(0,l.createElementVNode)("div",D,[a[20]||(a[20]=(0,l.createElementVNode)("div",{class:"col-2 text-weight-bold"},"标题：",-1)),(0,l.createElementVNode)("div",T,(0,l.toDisplayString)(G.value.title),1)]),(0,l.createElementVNode)("div",Q,[a[21]||(a[21]=(0,l.createElementVNode)("div",{class:"col-2 text-weight-bold"},"收件人：",-1)),(0,l.createElementVNode)("div",M,(0,l.toDisplayString)(G.value.tos),1)]),(0,l.createElementVNode)("div",P,[a[22]||(a[22]=(0,l.createElementVNode)("div",{class:"col-2 text-weight-bold"},"发送时间：",-1)),(0,l.createElementVNode)("div",U,(0,l.toDisplayString)(re(G.value.time)),1)]),(0,l.createElementVNode)("div",L,[a[23]||(a[23]=(0,l.createElementVNode)("div",{class:"col-2 text-weight-bold"},"请求IP：",-1)),(0,l.createElementVNode)("div",H,(0,l.toDisplayString)(G.value.clientip),1)]),(0,l.createVNode)(ge,{class:"q-my-md"}),(0,l.createElementVNode)("div",null,[a[24]||(a[24]=(0,l.createElementVNode)("div",{class:"text-weight-bold q-mb-sm"},"邮件内容：",-1)),(0,l.createElementVNode)("div",{class:"mail-detail-content",innerHTML:G.value.content},null,8,O)])])]),_:1})):(0,l.createCommentVNode)("",!0),(0,l.createVNode)(me,{align:"right"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(r,{flat:"",label:"关闭",onClick:a[7]||(a[7]=e=>Y.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),I=o(1317),z=o(10258),F=o(20407),Y=o(63663),$=o(17180),G=o(64503),J=o(97491),W=o(40975),K=o(85515),X=o(76997),Z=o(34854),ee=o(71248),te=o(74183),oe=o(51375),le=o(25915),ae=o(38622),re=o(5861),se=o(60515),ne=o(22110),ce=o.n(ne);const ie=(0,I.A)(j,[["__scopeId","data-v-4e5f52ac"]]);var de=ie;ce()(j,"components",{QBtnGroup:z.A,QBtn:F.A,QCard:Y.A,QCardSection:$.A,QIcon:G.A,QChip:J.A,QSelect:W.A,QAvatar:K.A,QTooltip:X.A,QPopupProxy:Z.A,QCardActions:ee.A,QPagination:te.A,QDialog:oe.A,QSpace:le.A,QInput:ae.A,QSeparator:re.A}),ce()(j,"directives",{ClosePopup:se.A})},13986:function(e,t,o){"use strict";var l=o(13719),a=o.n(l),r=o(27454),s=o.n(r),n=o(76661),c=o(57695);const i=a().create({baseURL:n.c.baseURL,timeout:n.c.timeOut});i.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=s().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&c.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return c.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:c.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:c.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:c.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:c.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:c.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:c.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:c.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:c.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:c.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:c.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=i},42634:function(){}}]);