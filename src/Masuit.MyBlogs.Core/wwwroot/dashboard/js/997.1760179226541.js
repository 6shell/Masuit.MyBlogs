(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[997],{253:function(){},3986:function(e,t,o){"use strict";var a=o(3719),r=o.n(a),s=o(7454),l=o.n(s),n=o(6661),i=o(7695);const c=r().create({baseURL:n.c.baseURL,timeout:n.c.timeOut});c.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=l().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),c.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&i.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return i.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:i.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:i.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:i.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:i.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:i.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:i.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:i.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:i.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:i.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:i.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=c},6576:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return L}});o(4564),o(324),o(7578);var a=o(4061),r=o(3508),s=o.n(r),l=o(3986),n=o(7695),i=o(6661);const c={class:"msgs-page"},d={class:"row items-center justify-between"},u={class:"q-gutter-sm"},p=["innerHTML"],m={class:"row items-center q-gutter-md"},C={class:"text-grey-6"},g={key:0,class:"q-mt-md flex justify-center items-center"},v={class:"q-ml-sm text-caption"};var f={__name:"index",setup(e){const t=(0,a.ref)(!1),o=(0,a.ref)(!1),r=(0,a.ref)(!1),f=(0,a.ref)([]),h=(0,a.reactive)({page:1,rowsPerPage:10,total:0}),w=async()=>{try{t.value=!0;const e=await l.A.get(`/msg/GetInternalMsgs?page=${h.page}&size=${h.rowsPerPage}`);f.value=e.Data.map(e=>({...e,updating:!1})),h.total=e.TotalCount}catch(e){n.oR.error("获取消息列表失败",{autoClose:2e3,position:"top-center"})}finally{t.value=!1}},V=e=>{if(!e)return"";try{return s()(e).format("YYYY-MM-DD HH:mm:ss")}catch(t){return e}},x=async e=>{e.Read||await N(e),e.Link&&window.open(i.A.baseURL+e.Link,"_blank")},N=async e=>{try{e.updating=!0;const t=e.Read?`/msg/read/${e.Id}`:`/msg/unread/${e.Id}`,o=await l.A.post(t);o?n.oR.success(e.Read?"标记已读成功":"标记未读成功",{autoClose:2e3,position:"top-center"}):n.oR.error(o.Message||"操作失败",{autoClose:2e3,position:"top-center"})}catch(t){console.error("切换消息状态失败:",t),e.Read=!e.Read,n.oR.error("操作失败",{autoClose:2e3,position:"top-center"})}finally{e.updating=!1}},k=async()=>{try{const e=f.value.filter(e=>!e.Read);if(0===e.length)return void n.oR.info("没有未读消息",{autoClose:2e3,position:"top-center"});o.value=!0;const t=Math.max(...f.value.map(e=>e.Id)),a=await l.A.post(`/msg/MarkRead/${t}`);a.Success?(await w(),n.oR.success("全部消息已标记为已读",{autoClose:2e3,position:"top-center"})):n.oR.error(a.Message||"标记失败",{autoClose:2e3,position:"top-center"})}catch(e){console.error("标记全部已读失败:",e),n.oR.error("标记失败",{autoClose:2e3,position:"top-center"})}finally{o.value=!1}},b=async()=>{try{r.value=!0;const e=await l.A.post("/msg/ClearMsgs");e.Success?(await w(),n.oR.success("已读消息清除成功",{autoClose:2e3,position:"top-center"})):n.oR.error(e.Message||"清除失败",{autoClose:2e3,position:"top-center"})}catch(e){console.error("清除消息失败:",e),n.oR.error("清除失败",{autoClose:2e3,position:"top-center"})}finally{r.value=!1}},y=async e=>{try{const t=await l.A.post(`/msg/deleteMsg/${e.Id}`);if(t.Success){const t=f.value.findIndex(t=>t.Id===e.Id);t>-1&&(f.value.splice(t,1),h.total--),n.oR.success("删除成功",{autoClose:2e3,position:"top-center"}),0===f.value.length&&h.page>1&&(h.page--,await w())}}catch(t){console.error("删除消息失败:",t),n.oR.error("删除失败",{autoClose:2e3,position:"top-center"})}},R=()=>{h.page=1,w()};return(0,a.onMounted)(()=>{w()}),(e,s)=>{const l=(0,a.resolveComponent)("q-btn"),n=(0,a.resolveComponent)("q-icon"),i=(0,a.resolveComponent)("q-card-section"),_=(0,a.resolveComponent)("q-card-actions"),q=(0,a.resolveComponent)("q-card"),A=(0,a.resolveComponent)("q-popup-proxy"),E=(0,a.resolveComponent)("q-checkbox"),M=(0,a.resolveComponent)("q-item-section"),P=(0,a.resolveComponent)("q-item-label"),B=(0,a.resolveComponent)("q-tooltip"),Q=(0,a.resolveComponent)("q-btn-group"),D=(0,a.resolveComponent)("q-item"),I=(0,a.resolveComponent)("q-spinner-dots"),S=(0,a.resolveComponent)("q-list"),T=(0,a.resolveComponent)("q-pagination"),L=(0,a.resolveComponent)("q-select"),z=(0,a.resolveDirective)("close-popup");return(0,a.openBlock)(),(0,a.createElementBlock)("div",c,[(0,a.createVNode)(q,{class:"q-mb-md"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(i,{class:"q-py-md"},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",d,[s[3]||(s[3]=(0,a.createElementVNode)("div",{class:"text-h5"},"消息中心",-1)),(0,a.createElementVNode)("div",u,[(0,a.createVNode)(l,{color:"info",icon:"refresh",label:"刷新",onClick:w,loading:t.value,dense:""},null,8,["loading"]),(0,a.createVNode)(l,{color:"positive",icon:"check",label:"全部已读",onClick:k,loading:o.value,disable:0===f.value.length,dense:""},null,8,["loading","disable"]),(0,a.createVNode)(l,{color:"negative",icon:"delete",label:"清除已读",loading:r.value,disable:0===f.value.length,dense:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(A,{breakpoint:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(q,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(i,{class:"row items-center"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(n,{name:"warning",color:"red",size:"2rem",class:"q-mr-sm"}),s[2]||(s[2]=(0,a.createElementVNode)("div",null,[(0,a.createElementVNode)("div",{class:"text-h6"},"确认操作"),(0,a.createElementVNode)("div",{class:"text-subtitle2"},"此操作将清除所有已读消息，是否继续？")],-1))]),_:1}),(0,a.createVNode)(_,{align:"right"},{default:(0,a.withCtx)(()=>[(0,a.withDirectives)((0,a.createVNode)(l,{flat:"",label:"确认",color:"negative",onClick:b},null,512),[[z]]),(0,a.withDirectives)((0,a.createVNode)(l,{flat:"",label:"取消",color:"primary"},null,512),[[z]])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading","disable"])])])]),_:1})]),_:1}),(0,a.createVNode)(q,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(S,{separator:""},{default:(0,a.withCtx)(()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(f.value,e=>((0,a.openBlock)(),(0,a.createBlock)(D,{key:e.Id,clickable:"",class:(0,a.normalizeClass)({"bg-grey-2":e.Read})},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(M,{side:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(E,{modelValue:e.Read,"onUpdate:modelValue":[t=>e.Read=t,t=>N(e)],loading:e.updating},null,8,["modelValue","onUpdate:modelValue","loading"])]),_:2},1024),(0,a.createVNode)(M,{onClick:t=>x(e)},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(P,{class:"text-subtitle1 text-weight-medium"},{default:(0,a.withCtx)(()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.Title),1)]),_:2},1024),(0,a.createVNode)(P,{caption:"",lines:"2"},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",{innerHTML:e.Content},null,8,p)]),_:2},1024),(0,a.createVNode)(P,{caption:"",class:"q-mt-xs"},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",m,[(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)([e.Read?"text-positive":"text-negative","text-weight-medium"])},(0,a.toDisplayString)(e.Read?"已读":"未读"),3),(0,a.createElementVNode)("span",C,(0,a.toDisplayString)(V(e.Time)),1)])]),_:2},1024)]),_:2},1032,["onClick"]),(0,a.createVNode)(M,{side:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(Q,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(l,{flat:"",color:"primary",icon:"open_in_new",dense:"",disable:!e.Link,onClick:(0,a.withModifiers)(t=>x(e),["stop"])},null,8,["disable","onClick"]),(0,a.createVNode)(l,{flat:"",color:"negative",icon:"delete",dense:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(B,null,{default:(0,a.withCtx)(()=>[...s[4]||(s[4]=[(0,a.createTextVNode)("删除",-1)])]),_:1}),(0,a.createVNode)(A,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(q,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(i,{class:"row items-center"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(n,{name:"warning",color:"red",size:"2rem",class:"q-mr-sm"}),s[5]||(s[5]=(0,a.createElementVNode)("div",null,[(0,a.createElementVNode)("div",{class:"text-h6"},"确认删除"),(0,a.createElementVNode)("div",{class:"text-subtitle2"},"确认删除这条消息吗？")],-1))]),_:1}),(0,a.createVNode)(_,{align:"right"},{default:(0,a.withCtx)(()=>[(0,a.withDirectives)((0,a.createVNode)(l,{flat:"",label:"确认",color:"negative",onClick:t=>y(e)},null,8,["onClick"]),[[z]]),(0,a.withDirectives)((0,a.createVNode)(l,{flat:"",label:"取消",color:"primary"},null,512),[[z]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128)),t.value||0!==f.value.length?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createBlock)(D,{key:0},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(M,{class:"text-center q-py-xl"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(n,{name:"inbox",size:"4rem",color:"grey-4"}),s[6]||(s[6]=(0,a.createElementVNode)("div",{class:"text-grey-6 q-mt-md"},"暂无消息",-1))]),_:1})]),_:1})),t.value?((0,a.openBlock)(),(0,a.createBlock)(D,{key:1},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(M,{class:"text-center q-py-xl"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(I,{size:"2rem",color:"primary"}),s[7]||(s[7]=(0,a.createElementVNode)("div",{class:"text-grey-6 q-mt-md"},"加载中...",-1))]),_:1})]),_:1})):(0,a.createCommentVNode)("",!0)]),_:1})]),_:1}),f.value.length>0?((0,a.openBlock)(),(0,a.createElementBlock)("div",g,[(0,a.createVNode)(T,{modelValue:h.page,"onUpdate:modelValue":[s[0]||(s[0]=e=>h.page=e),w],max:Math.ceil(h.total/h.rowsPerPage),"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max"]),(0,a.createVNode)(L,{modelValue:h.rowsPerPage,"onUpdate:modelValue":[s[1]||(s[1]=e=>h.rowsPerPage=e),R],options:[10,15,20,30,50,100,200],dense:"",outlined:"",class:"q-ml-md",style:{width:"80px"}},null,8,["modelValue"]),(0,a.createElementVNode)("span",v,"共 "+(0,a.toDisplayString)(h.total)+" 条",1)])):(0,a.createCommentVNode)("",!0)])}}},h=o(1317),w=o(3663),V=o(7180),x=o(407),N=o(4854),k=o(4503),b=o(1248),y=o(5668),R=o(5740),_=o(1484),q=o(8495),A=o(2473),E=o(7877),M=o(6997),P=o(5801),B=o(4183),Q=o(975),D=o(515),I=o(2110),S=o.n(I);const T=(0,h.A)(f,[["__scopeId","data-v-07eb0de4"]]);var L=T;S()(f,"components",{QCard:w.A,QCardSection:V.A,QBtn:x.A,QPopupProxy:N.A,QIcon:k.A,QCardActions:b.A,QList:y.A,QItem:R.A,QItemSection:_.A,QCheckbox:q.A,QItemLabel:A.A,QBtnGroup:E.A,QTooltip:M.A,QSpinnerDots:P.A,QPagination:B.A,QSelect:Q.A}),S()(f,"directives",{ClosePopup:D.A})}}]);