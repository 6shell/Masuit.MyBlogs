(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[772],{13986:function(e,l,t){"use strict";var a=t(74413),o=t(27454),s=t.n(o),i=t(76661),r=t(57695);const n=a.A.create({baseURL:i.c.baseURL,timeout:i.c.timeOut});n.interceptors.request.use(e=>{const l=sessionStorage.getItem("access_token");if(l&&(e.headers.Authorization="Bearer "+l),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=s().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&r.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return r.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:r.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:r.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:r.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:r.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:r.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:r.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:r.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:r.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:r.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:r.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),l.A=n},42634:function(){},90595:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return ve}});var a=t(74220),o=t(97700),s=t(46732),i=t(57695),r=t(13986),n=t(88828),c=t.n(n);const u={class:"sendbox-page"},d={class:"row q-mb-md"},v={class:"col text-right"},m={class:"text-h6 q-mb-md"},b={key:0,class:"text-center q-pa-xl text-grey-6"},p={key:1},k={class:"row items-center justify-between q-mb-md"},g={class:"col-auto"},f={class:"text-body2 text-grey-7"},h={class:"col-auto"},L={class:"row q-gutter-md"},F={class:"row items-start q-gutter-md"},x={class:"col-auto"},y={class:"col"},q={class:"text-h6 text-weight-bold q-mb-xs"},w=["innerHTML"],C={class:"row q-gutter-md text-body2 text-grey-6"},_={class:"col-auto"},R={class:"col-auto"},A={class:"col-auto"},V=["href"],Q={class:"col-auto"},M={key:0,class:"row justify-center q-mt-md"},E={class:"q-gutter-md"},T={class:"q-gutter-md"},P={class:"row"},W={class:"col-10"},K={class:"row"},U={class:"col-10"},S={class:"row"},H={class:"col-10"},I={class:"row"},O={class:"col-10"},X=["innerHTML"];var j=(0,a.pM)({__name:"sendbox",setup(e){const l=(0,s.KR)([]),t=(0,s.KR)(!1),n=(0,s.KR)(!1),j=(0,s.KR)(1),z=(0,s.KR)(10),B=[{label:"5条/页",value:5},{label:"10条/页",value:10},{label:"20条/页",value:20},{label:"50条/页",value:50}],D=(0,s.KR)(!1),N=(0,s.KR)(!1),Y=(0,s.KR)({tos:"",title:"",content:""}),$=(0,s.KR)(null),G=(0,a.EW)(()=>Math.ceil(l.value.length/z.value)),J=(0,a.EW)(()=>{const e=(j.value-1)*z.value,t=e+z.value;return l.value.slice(e,t)}),Z=e=>{j.value=e},ee=e=>{z.value=e,j.value=1},le=async()=>{t.value=!0;try{const e=await r.A.get("/system/sendbox");Array.isArray(e)?l.value=e:l.value=[]}catch(e){i.oR.error("加载邮件列表失败",{autoClose:2e3,position:"top-center"}),console.error("Error loading mails:",e),l.value=[]}finally{t.value=!1}},te=()=>{Y.value={tos:"",title:"",content:""},D.value=!0},ae=()=>{D.value=!1},oe=async()=>{if(Y.value.tos&&Y.value.title){n.value=!0;try{const e=await r.A.post("/system/sendmail",Y.value);!1!==e?.Success?(i.oR.success("邮件发送成功",{autoClose:2e3,position:"top-center"}),ae(),setTimeout(()=>{le()},500)):i.oR.error(e?.Message||"邮件发送失败",{autoClose:2e3,position:"top-center"})}catch(e){i.oR.error("邮件发送失败",{autoClose:2e3,position:"top-center"}),console.error("Error sending mail:",e)}finally{n.value=!1}}else i.oR.warning("请填写完整的邮件信息",{autoClose:2e3,position:"top-center"})},se=e=>{$.value=e,N.value=!0},ie=async e=>{const l=await r.A.post(`/system/AddToBlackList/${e}`);i.oR.success(l?.Message||"已加入黑名单",{autoClose:2e3,position:"top-center"})},re=e=>c()(e).format("YYYY-MM-DD HH:mm:ss");return(0,a.sV)(()=>{le()}),(e,s)=>{const i=(0,a.g2)("q-btn"),r=(0,a.g2)("q-btn-group"),c=(0,a.g2)("q-icon"),ne=(0,a.g2)("q-chip"),ce=(0,a.g2)("q-select"),ue=(0,a.g2)("q-avatar"),de=(0,a.g2)("q-tooltip"),ve=(0,a.g2)("q-card-section"),me=(0,a.g2)("q-card-actions"),be=(0,a.g2)("q-card"),pe=(0,a.g2)("q-popup-proxy"),ke=(0,a.g2)("q-pagination"),ge=(0,a.g2)("q-space"),fe=(0,a.g2)("q-input"),he=(0,a.g2)("vue-ueditor-wrap"),Le=(0,a.g2)("q-dialog"),Fe=(0,a.g2)("q-separator"),xe=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)("div",u,[(0,a.Lk)("div",d,[s[9]||(s[9]=(0,a.Lk)("div",{class:"col text-h6"}," 发件箱管理 ",-1)),(0,a.Lk)("div",v,[(0,a.bF)(r,null,{default:(0,a.k6)(()=>[(0,a.bF)(i,{color:"primary",icon:"refresh",label:"刷新",onClick:le,loading:t.value},null,8,["loading"]),(0,a.bF)(i,{color:"positive",icon:"add",label:"新建邮件",onClick:te})]),_:1})])]),(0,a.bF)(be,{flat:"",bordered:""},{default:(0,a.k6)(()=>[(0,a.bF)(ve,null,{default:(0,a.k6)(()=>[(0,a.Lk)("div",m,[(0,a.bF)(c,{name:"outgoing_mail",class:"q-mr-sm"}),s[10]||(s[10]=(0,a.eW)(" 邮件列表 ",-1)),l.value.length>0?((0,a.uX)(),(0,a.Wv)(ne,{key:0,color:"primary","text-color":"white",label:`共 ${l.value.length} 封邮件`,class:"q-ml-sm"},null,8,["label"])):(0,a.Q3)("",!0)]),0!==l.value.length||t.value?((0,a.uX)(),(0,a.CE)("div",p,[(0,a.Lk)("div",k,[(0,a.Lk)("div",g,[(0,a.Lk)("span",f," 共 "+(0,o.v_)(l.value.length)+" 条记录，当前显示第 "+(0,o.v_)((j.value-1)*z.value+1)+" - "+(0,o.v_)(Math.min(j.value*z.value,l.value.length))+" 条 ",1)]),(0,a.Lk)("div",h,[(0,a.bF)(ce,{modelValue:z.value,"onUpdate:modelValue":[s[0]||(s[0]=e=>z.value=e),ee],options:B,dense:"",outlined:"",label:"每页显示",style:{"min-width":"120px"}},null,8,["modelValue"])])]),(0,a.Lk)("div",L,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(J.value,(e,l)=>((0,a.uX)(),(0,a.CE)("div",{key:l,class:"col-12"},[(0,a.bF)(be,{class:"mail-card",flat:"",bordered:""},{default:(0,a.k6)(()=>[(0,a.bF)(ve,null,{default:(0,a.k6)(()=>[(0,a.Lk)("div",F,[(0,a.Lk)("div",x,[(0,a.bF)(ue,{color:"primary","text-color":"white",icon:"mail",size:"48px"})]),(0,a.Lk)("div",y,[(0,a.Lk)("div",q,(0,o.v_)(e.title||"无标题"),1),(0,a.Lk)("div",{class:"text-body2 text-grey-7 q-mb-md mail-content",innerHTML:e.content},null,8,w),(0,a.Lk)("div",C,[(0,a.Lk)("div",_,[(0,a.bF)(c,{name:"person",class:"q-mr-xs"}),(0,a.eW)(" 收件人："+(0,o.v_)(e.tos),1)]),(0,a.Lk)("div",R,[(0,a.bF)(c,{name:"schedule",class:"q-mr-xs"}),(0,a.eW)(" 发送时间："+(0,o.v_)(re(e.time)),1)]),(0,a.Lk)("div",A,[(0,a.bF)(c,{name:"computer",class:"q-mr-xs"}),s[15]||(s[15]=(0,a.eW)(" 请求IP： ",-1)),(0,a.Lk)("a",{href:`/tools/ip/${e.clientip}`,target:"_blank",class:"text-primary"},(0,o.v_)(e.clientip),9,V),(0,a.bF)(i,{color:"negative",icon:"block",dense:"",flat:"",size:"sm",class:"q-ml-sm"},{default:(0,a.k6)(()=>[(0,a.bF)(de,null,{default:(0,a.k6)(()=>[...s[13]||(s[13]=[(0,a.eW)("添加到黑名单",-1)])]),_:1}),(0,a.bF)(pe,{breakpoint:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)(()=>[(0,a.bF)(be,null,{default:(0,a.k6)(()=>[(0,a.bF)(ve,{class:"row items-center"},{default:(0,a.k6)(()=>[(0,a.bF)(c,{name:"warning",color:"red",size:"2rem",class:"q-mr-sm"}),s[14]||(s[14]=(0,a.Lk)("div",null,[(0,a.Lk)("div",{class:"text-h6"},"确认操作"),(0,a.Lk)("div",{class:"text-subtitle2"},"此操作将标记该用户IP为黑名单，是否继续？")],-1))]),_:1}),(0,a.bF)(me,{align:"right"},{default:(0,a.k6)(()=>[(0,a.bo)((0,a.bF)(i,{flat:"",label:"确认",color:"negative",onClick:l=>ie(e.clientip)},null,8,["onClick"]),[[xe]]),(0,a.bo)((0,a.bF)(i,{flat:"",label:"取消",color:"primary"},null,512),[[xe]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)])])]),(0,a.Lk)("div",Q,[(0,a.bF)(i,{color:"info",icon:"visibility",flat:"",round:"",onClick:l=>se(e)},{default:(0,a.k6)(()=>[(0,a.bF)(de,null,{default:(0,a.k6)(()=>[...s[16]||(s[16]=[(0,a.eW)("查看详情",-1)])]),_:1})]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024)]))),128))]),G.value>1?((0,a.uX)(),(0,a.CE)("div",M,[(0,a.bF)(ke,{modelValue:j.value,"onUpdate:modelValue":[s[1]||(s[1]=e=>j.value=e),Z],max:G.value,"max-pages":6,"direction-links":"","boundary-links":"",color:"primary"},null,8,["modelValue","max"])])):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",b,[(0,a.bF)(c,{name:"mail_outline",size:"64px",class:"q-mb-md"}),s[11]||(s[11]=(0,a.Lk)("div",{class:"text-h6"},"暂无邮件记录",-1)),s[12]||(s[12]=(0,a.Lk)("div",{class:"text-body2 q-mt-sm"},'点击上方"新建邮件"按钮发送第一封邮件',-1))]))]),_:1})]),_:1}),(0,a.bF)(Le,{modelValue:D.value,"onUpdate:modelValue":s[5]||(s[5]=e=>D.value=e),persistent:""},{default:(0,a.k6)(()=>[(0,a.bF)(be,{style:{"min-width":"800px","max-width":"75vw"}},{default:(0,a.k6)(()=>[(0,a.bF)(ve,{class:"row items-center q-pb-none"},{default:(0,a.k6)(()=>[s[17]||(s[17]=(0,a.Lk)("div",{class:"text-h6"},"发送邮件",-1)),(0,a.bF)(ge),(0,a.bF)(i,{icon:"close",flat:"",round:"",dense:"",onClick:ae})]),_:1}),(0,a.bF)(ve,null,{default:(0,a.k6)(()=>[(0,a.Lk)("div",E,[(0,a.bF)(fe,{modelValue:Y.value.tos,"onUpdate:modelValue":s[2]||(s[2]=e=>Y.value.tos=e),label:"收件人",hint:"多个邮箱用逗号分隔",dense:"",outlined:"",required:"",rules:[e=>!!e||"请输入收件人"]},null,8,["modelValue","rules"]),(0,a.bF)(fe,{modelValue:Y.value.title,"onUpdate:modelValue":s[3]||(s[3]=e=>Y.value.title=e),label:"邮件标题",dense:"",outlined:"",required:"",rules:[e=>!!e||"请输入邮件标题"]},null,8,["modelValue","rules"]),s[18]||(s[18]=(0,a.Lk)("div",{class:"text-subtitle2"},"邮件内容：",-1)),(0,a.bF)(he,{modelValue:Y.value.content,"onUpdate:modelValue":s[4]||(s[4]=e=>Y.value.content=e),config:{initialFrameHeight:200,initialFrameWidth:"100%"}},null,8,["modelValue"])])]),_:1}),(0,a.bF)(me,{align:"right"},{default:(0,a.k6)(()=>[(0,a.bF)(i,{flat:"",label:"取消",onClick:ae}),(0,a.bF)(i,{icon:"send",color:"primary",label:"发送",onClick:oe,loading:n.value,disable:!Y.value.tos||!Y.value.title},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,a.bF)(Le,{modelValue:N.value,"onUpdate:modelValue":s[8]||(s[8]=e=>N.value=e)},{default:(0,a.k6)(()=>[(0,a.bF)(be,{style:{"min-width":"700px","max-width":"90vw"}},{default:(0,a.k6)(()=>[(0,a.bF)(ve,{class:"row items-center q-pb-none"},{default:(0,a.k6)(()=>[s[19]||(s[19]=(0,a.Lk)("div",{class:"text-h6"},"邮件详情",-1)),(0,a.bF)(ge),(0,a.bF)(i,{icon:"close",flat:"",round:"",dense:"",onClick:s[6]||(s[6]=e=>N.value=!1)})]),_:1}),$.value?((0,a.uX)(),(0,a.Wv)(ve,{key:0},{default:(0,a.k6)(()=>[(0,a.Lk)("div",T,[(0,a.Lk)("div",P,[s[20]||(s[20]=(0,a.Lk)("div",{class:"col-2 text-weight-bold"},"标题：",-1)),(0,a.Lk)("div",W,(0,o.v_)($.value.title),1)]),(0,a.Lk)("div",K,[s[21]||(s[21]=(0,a.Lk)("div",{class:"col-2 text-weight-bold"},"收件人：",-1)),(0,a.Lk)("div",U,(0,o.v_)($.value.tos),1)]),(0,a.Lk)("div",S,[s[22]||(s[22]=(0,a.Lk)("div",{class:"col-2 text-weight-bold"},"发送时间：",-1)),(0,a.Lk)("div",H,(0,o.v_)(re($.value.time)),1)]),(0,a.Lk)("div",I,[s[23]||(s[23]=(0,a.Lk)("div",{class:"col-2 text-weight-bold"},"请求IP：",-1)),(0,a.Lk)("div",O,(0,o.v_)($.value.clientip),1)]),(0,a.bF)(Fe,{class:"q-my-md"}),(0,a.Lk)("div",null,[s[24]||(s[24]=(0,a.Lk)("div",{class:"text-weight-bold q-mb-sm"},"邮件内容：",-1)),(0,a.Lk)("div",{class:"mail-detail-content",innerHTML:$.value.content},null,8,X)])])]),_:1})):(0,a.Q3)("",!0),(0,a.bF)(me,{align:"right"},{default:(0,a.k6)(()=>[(0,a.bF)(i,{flat:"",label:"关闭",onClick:s[7]||(s[7]=e=>N.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),z=t(1317),B=t(10258),D=t(20407),N=t(63663),Y=t(17180),$=t(64503),G=t(97491),J=t(40975),Z=t(85515),ee=t(76997),le=t(34854),te=t(71248),ae=t(74183),oe=t(51375),se=t(25915),ie=t(38622),re=t(5861),ne=t(60515),ce=t(22110),ue=t.n(ce);const de=(0,z.A)(j,[["__scopeId","data-v-62318777"]]);var ve=de;ue()(j,"components",{QBtnGroup:B.A,QBtn:D.A,QCard:N.A,QCardSection:Y.A,QIcon:$.A,QChip:G.A,QSelect:J.A,QAvatar:Z.A,QTooltip:ee.A,QPopupProxy:le.A,QCardActions:te.A,QPagination:ae.A,QDialog:oe.A,QSpace:se.A,QInput:ie.A,QSeparator:re.A}),ue()(j,"directives",{ClosePopup:ne.A})}}]);