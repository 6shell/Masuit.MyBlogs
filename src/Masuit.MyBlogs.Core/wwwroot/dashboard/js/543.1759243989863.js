(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[543],{13986:function(e,o,a){"use strict";var l=a(74413),t=a(27454),s=a.n(t),r=a(76661),n=a(57695);const u=l.A.create({baseURL:r.c.baseURL,timeout:r.c.timeOut});u.interceptors.request.use(e=>{const o=sessionStorage.getItem("access_token");if(o&&(e.headers.Authorization="Bearer "+o),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=s().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),u.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&n.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return n.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:n.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:n.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:n.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:n.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:n.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:n.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:n.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:n.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:n.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:n.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),o.A=u},42634:function(){},60322:function(e,o,a){"use strict";a.r(o),a.d(o,{default:function(){return S}});var l=a(74220),t=a(97700),s=a(39798),r=a(46732),n=a(57695),u=a(13986);const i={class:"category-container"},d={class:"q-mb-lg"},c={class:"row items-center justify-between"},v={class:"col-auto"},p={class:"q-gutter-sm"},b={class:"col-auto"},k={class:"row items-center full-width"},m={class:"col"},f={class:"row items-center q-gutter-sm"},g={class:"text-weight-bold"},C=["href"],h={key:0,class:"text-caption text-grey-7 q-mt-xs"},R={class:"col-auto"},F={class:"q-gutter-xs"},_={class:"text-h6"},y={class:"q-mb-md"};var w=(0,l.pM)({__name:"category",setup(e){const o=(0,r.KR)(!1),a=(0,r.KR)(!1),w=(0,r.KR)(!1),q=(0,r.KR)(!1),L=(0,r.KR)(""),A=(0,r.KR)([]),I=(0,r.KR)([]),V=(0,r.KR)(!1),x=(0,r.KR)(!1),N=(0,r.KR)(""),D=(0,r.KR)({}),K=(0,r.KR)(null),Q=(0,r.KR)(null),U=(0,r.KR)(null),E=(0,l.EW)(()=>L.value?$(A.value,L.value):A.value),O=(0,l.EW)(()=>{const e=M(A.value);return e.filter(e=>e.Id!==K.value?.Id)}),$=(e,o)=>e.reduce((e,a)=>{const l=a.Name.toLowerCase().includes(o.toLowerCase()),t=a.Children?$(a.Children,o):[];return(l||t.length>0)&&e.push({...a,Children:t}),e},[]),M=e=>{const o=[],a=e=>{e.forEach(e=>{o.push(e),e.Children&&a(e.Children)})};return a(e),o},S=(e,o)=>e.Name.toLowerCase().includes(o.toLowerCase()),T=async()=>{o.value=!0;const e=await u.A.get("/category/GetCategories");e?.Data&&(A.value=e.Data,0===I.value.length&&(I.value=A.value.map(e=>e.Id))),o.value=!1},W=()=>{const e=[],o=a=>{a.forEach(a=>{e.push(a.Id),a.Children&&o(a.Children)})};o(A.value),I.value=e},j=()=>{q.value=!q.value,q.value?W():I.value=[]},P=e=>{I.value=e},z=()=>{D.value={Name:"",Description:"",ParentId:null},N.value="添加根分类",V.value=!0},B=e=>{D.value={Name:"",Description:"",ParentId:e.Id},N.value=`添加子分类到 "${e.Name}"`,V.value=!0},X=e=>{D.value={...e},N.value="编辑分类",V.value=!0},G=()=>{V.value=!1,D.value={}},H=async()=>{if(!D.value.Name?.trim())return void n.oR.error("请输入分类名称",{autoClose:2e3,position:"top-center"});a.value=!0;const e=await u.A.post("/category/save",D.value);n.oR.success(e?.Message||"操作成功",{autoClose:2e3,position:"top-center"}),V.value=!1,D.value={},await T(),a.value=!1},J=async e=>{1!==e.Id?(K.value=e,Q.value=null,x.value=!0):n.oR.error("默认分类不能被删除！",{autoClose:2e3,position:"top-center"})},Y=()=>{x.value=!1,K.value=null,Q.value=null},Z=async()=>{if(!Q.value)return void n.oR.error("请选择一个分类",{autoClose:2e3,position:"top-center"});if(1===K.value?.Id)return void n.oR.error("默认分类不能被删除！",{autoClose:2e3,position:"top-center"});w.value=!0;const e=`/category/delete?id=${K.value?.Id}&cid=${Q.value}`,o=await u.A.post(e);n.oR.success(o?.Message||"删除成功",{autoClose:2e3,position:"top-center"}),x.value=!1,K.value=null,Q.value=null,await T(),w.value=!1};return(0,l.sV)(()=>{T()}),(e,r)=>{const n=(0,l.g2)("q-btn"),u=(0,l.g2)("q-icon"),A=(0,l.g2)("q-input"),$=(0,l.g2)("q-tooltip"),M=(0,l.g2)("q-tree"),ee=(0,l.g2)("q-card-section"),oe=(0,l.g2)("q-card"),ae=(0,l.g2)("q-form"),le=(0,l.g2)("q-card-actions"),te=(0,l.g2)("q-dialog"),se=(0,l.g2)("q-select");return(0,l.uX)(),(0,l.CE)("div",i,[r[14]||(r[14]=(0,l.Lk)("div",{class:"text-h4 q-mb-lg"},"分类管理",-1)),(0,l.Lk)("div",d,[(0,l.Lk)("div",c,[(0,l.Lk)("div",v,[(0,l.Lk)("div",p,[(0,l.bF)(n,{color:"positive",icon:"add",label:"新增分类",onClick:z}),(0,l.bF)(n,{color:"info",icon:"unfold_more",label:q.value?"收起全部":"展开全部",onClick:j},null,8,["label"]),(0,l.bF)(n,{color:"primary",icon:"refresh",label:"刷新",onClick:T,loading:o.value},null,8,["loading"])])]),(0,l.Lk)("div",b,[(0,l.bF)(A,{modelValue:L.value,"onUpdate:modelValue":[r[0]||(r[0]=e=>L.value=e),W],outlined:"",dense:"",placeholder:"搜索分类名称",debounce:"100"},{prepend:(0,l.k6)(()=>[(0,l.bF)(u,{name:"search"})]),_:1},8,["modelValue"])])])]),(0,l.bF)(oe,null,{default:(0,l.k6)(()=>[(0,l.bF)(ee,null,{default:(0,l.k6)(()=>[(0,l.bF)(M,{ref_key:"treeRef",ref:U,nodes:E.value,"node-key":"Id","label-key":"Name","children-key":"Children",expanded:I.value,"onUpdate:expanded":[r[1]||(r[1]=e=>I.value=e),P],filter:L.value,"filter-method":S,"no-connectors":""},{"default-header":(0,l.k6)(e=>[(0,l.Lk)("div",k,[(0,l.Lk)("div",m,[(0,l.Lk)("div",f,[(0,l.Lk)("div",g,[(0,l.Lk)("a",{href:`/cat/${e.node.Id}`,target:"_blank",class:"text-primary"},(0,t.v_)(e.node.Id)+"："+(0,t.v_)(e.node.Name),9,C)])]),e.node.Description?((0,l.uX)(),(0,l.CE)("div",h,(0,t.v_)(e.node.Description),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("div",R,[(0,l.Lk)("div",F,[(0,l.bF)(n,{size:"sm",color:"primary",icon:"add",dense:"",round:"",onClick:(0,s.D$)(o=>B(e.node),["stop"])},{default:(0,l.k6)(()=>[(0,l.bF)($,null,{default:(0,l.k6)(()=>[...r[7]||(r[7]=[(0,l.eW)("添加子分类",-1)])]),_:1})]),_:1},8,["onClick"]),(0,l.bF)(n,{size:"sm",color:"info",icon:"edit",dense:"",round:"",onClick:(0,s.D$)(o=>X(e.node),["stop"])},{default:(0,l.k6)(()=>[(0,l.bF)($,null,{default:(0,l.k6)(()=>[...r[8]||(r[8]=[(0,l.eW)("编辑分类",-1)])]),_:1})]),_:1},8,["onClick"]),(0,l.bF)(n,{size:"sm",color:"negative",icon:"delete",dense:"",round:"",onClick:(0,s.D$)(o=>J(e.node),["stop"]),disable:1===e.node.Id},{default:(0,l.k6)(()=>[(0,l.bF)($,null,{default:(0,l.k6)(()=>[...r[9]||(r[9]=[(0,l.eW)("删除分类",-1)])]),_:1})]),_:1},8,["onClick","disable"])])])])]),_:1},8,["nodes","expanded","filter"])]),_:1})]),_:1}),(0,l.bF)(te,{modelValue:V.value,"onUpdate:modelValue":r[4]||(r[4]=e=>V.value=e),persistent:""},{default:(0,l.k6)(()=>[(0,l.bF)(oe,{style:{"min-width":"500px"}},{default:(0,l.k6)(()=>[(0,l.bF)(ee,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",_,(0,t.v_)(N.value),1)]),_:1}),(0,l.bF)(ee,{class:"q-pt-none"},{default:(0,l.k6)(()=>[(0,l.bF)(ae,{onSubmit:H,class:"q-gutter-md"},{default:(0,l.k6)(()=>[(0,l.bF)(A,{modelValue:D.value.Name,"onUpdate:modelValue":r[2]||(r[2]=e=>D.value.Name=e),label:"分类名称",outlined:"",dense:"",rules:[e=>!!e||"请输入分类名称"],"lazy-rules":""},null,8,["modelValue","rules"]),(0,l.bF)(A,{modelValue:D.value.Description,"onUpdate:modelValue":r[3]||(r[3]=e=>D.value.Description=e),label:"分类描述",outlined:"",dense:"",type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1}),(0,l.bF)(le,{align:"right"},{default:(0,l.k6)(()=>[(0,l.bF)(n,{flat:"",label:"取消",color:"grey",onClick:G}),(0,l.bF)(n,{label:"确认",color:"primary",onClick:H,loading:a.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(te,{modelValue:x.value,"onUpdate:modelValue":r[6]||(r[6]=e=>x.value=e),persistent:""},{default:(0,l.k6)(()=>[(0,l.bF)(oe,{style:{"min-width":"500px"}},{default:(0,l.k6)(()=>[(0,l.bF)(ee,null,{default:(0,l.k6)(()=>[...r[10]||(r[10]=[(0,l.Lk)("div",{class:"text-h6"},"删除分类",-1)])]),_:1}),(0,l.bF)(ee,{class:"q-pt-none"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",y,[r[11]||(r[11]=(0,l.eW)(" 确定要删除分类 ",-1)),(0,l.Lk)("strong",null,(0,t.v_)(K.value?.Name),1),r[12]||(r[12]=(0,l.eW)(" 吗？ ",-1))]),r[13]||(r[13]=(0,l.Lk)("div",{class:"q-mb-md"}," 删除后将该分类下的所有文章移动到： ",-1)),(0,l.bF)(se,{modelValue:Q.value,"onUpdate:modelValue":r[5]||(r[5]=e=>Q.value=e),options:O.value,"option-label":"Name","option-value":"Id","emit-value":"","map-options":"",outlined:"",dense:"",label:"选择目标分类",rules:[e=>!!e||"请选择一个分类"]},null,8,["modelValue","options","rules"])]),_:1}),(0,l.bF)(le,{align:"right"},{default:(0,l.k6)(()=>[(0,l.bF)(n,{flat:"",label:"取消",color:"grey",onClick:Y}),(0,l.bF)(n,{label:"确认删除",color:"negative",onClick:Z,loading:w.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),q=a(1317),L=a(20407),A=a(38622),I=a(64503),V=a(63663),x=a(17180),N=a(26455),D=a(76997),K=a(51375),Q=a(93483),U=a(71248),E=a(40975),O=a(22110),$=a.n(O);const M=(0,q.A)(w,[["__scopeId","data-v-5bfb2c14"]]);var S=M;$()(w,"components",{QBtn:L.A,QInput:A.A,QIcon:I.A,QCard:V.A,QCardSection:x.A,QTree:N.A,QTooltip:D.A,QDialog:K.A,QForm:Q.A,QCardActions:U.A,QSelect:E.A})}}]);