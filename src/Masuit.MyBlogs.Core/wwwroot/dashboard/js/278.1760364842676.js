(self["webpackChunk"]=self["webpackChunk"]||[]).push([[278],{253:function(){},3885:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return E}});var a=o(4061),r=o(7695),s=o(3992),n=o(3508),l=o.n(n),i=o(3986);const c={class:"messages-page"},d={class:"q-mb-md"},u=["href"],p=["innerHTML"],m={class:"q-mt-md flex justify-center items-center"},C={class:"q-ml-sm text-caption"};var f=(0,a.defineComponent)({__name:"msgs",setup(e){(0,s.useRouter)();const t=(0,a.ref)(!1),o=(0,a.ref)([]),n=(0,a.ref)({page:1,rowsPerPage:10,total:0}),f=(0,a.ref)(null),g=e=>l()(e).format("YYYY-MM-DD HH:mm:ss"),v=()=>{n.value.page=1,w()},w=async()=>{t.value=!0;try{const e=await i.A.get(`/msg/GetPendingMsgs?page=${n.value.page}&size=${n.value.rowsPerPage}`);e&&(o.value=e.Data||[],n.value.total=e.TotalCount||0)}catch(e){r.oR.error("加载数据失败",{autoClose:2e3,position:"top-center"}),console.error("Error loading data:",e)}finally{t.value=!1}},h=async e=>{try{const t=await i.A.post(`/msg/delete/${e.Id}`);t?.Success?(r.oR.success(t.Message||"删除成功",{autoClose:2e3,position:"top-center"}),await w()):r.oR.error(t?.Message||"删除失败",{autoClose:2e3,position:"top-center"})}catch(t){r.oR.error("删除失败",{autoClose:2e3,position:"top-center"}),console.error("Error deleting message:",t)}},N=async e=>{try{const t=await i.A.post("/msg/pass/"+e.Id);t?.Success?(r.oR.success(t.Message||"审核通过",{autoClose:2e3,position:"top-center"}),await w()):r.oR.error(t?.Message||"审核失败",{autoClose:2e3,position:"top-center"})}catch(t){r.oR.error("审核失败",{autoClose:2e3,position:"top-center"}),console.error("Error passing message:",t)}};return(0,a.onMounted)(()=>{w()}),(e,r)=>{const s=(0,a.resolveComponent)("q-btn"),l=(0,a.resolveComponent)("vxe-column"),i=(0,a.resolveComponent)("q-icon"),V=(0,a.resolveComponent)("q-card-section"),x=(0,a.resolveComponent)("q-card-actions"),b=(0,a.resolveComponent)("q-card"),k=(0,a.resolveComponent)("q-popup-proxy"),R=(0,a.resolveComponent)("q-tooltip"),y=(0,a.resolveComponent)("q-btn-group"),_=(0,a.resolveComponent)("vxe-table"),A=(0,a.resolveComponent)("q-pagination"),P=(0,a.resolveComponent)("q-select"),q=(0,a.resolveDirective)("close-popup");return(0,a.openBlock)(),(0,a.createElementBlock)("div",c,[(0,a.createVNode)(b,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(V,null,{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",d,[(0,a.createVNode)(s,{color:"info",icon:"refresh",label:"刷新",onClick:w,loading:t.value},null,8,["loading"])]),(0,a.createVNode)(_,{ref_key:"tableRef",ref:f,data:o.value,loading:t.value,stripe:"",border:"",class:"limited-row-height"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(l,{field:"NickName",title:"昵称",width:"120",fixed:"left"}),(0,a.createVNode)(l,{field:"Content",title:"内容","min-width":"300"},{default:(0,a.withCtx)(({row:e})=>[(0,a.createElementVNode)("a",{href:`/msg?cid=${e.Id}#comment`,target:"_blank",class:"text-primary"},[(0,a.createElementVNode)("div",{class:"message-content",innerHTML:e.Content},null,8,p)],8,u)]),_:1}),(0,a.createVNode)(l,{field:"PostDate",title:"留言时间",width:"180",sortable:""},{default:(0,a.withCtx)(({row:e})=>[(0,a.createTextVNode)((0,a.toDisplayString)(g(e.PostDate)),1)]),_:1}),(0,a.createVNode)(l,{field:"Email",title:"邮箱",width:"200"}),(0,a.createVNode)(l,{field:"OperatingSystem",title:"操作系统",width:"140"}),(0,a.createVNode)(l,{field:"Browser",title:"浏览器",width:"140"}),(0,a.createVNode)(l,{title:"操作",width:"80",fixed:"right"},{default:(0,a.withCtx)(({row:e})=>[(0,a.createVNode)(y,{push:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(s,{size:"md",color:"negative",icon:"delete",dense:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(k,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(b,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(V,{class:"row items-center"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(i,{name:"warning",color:"red",size:"2rem",class:"q-mr-sm"}),r[2]||(r[2]=(0,a.createElementVNode)("div",null,[(0,a.createElementVNode)("div",{class:"text-h6"},"确认删除"),(0,a.createElementVNode)("div",{class:"text-subtitle2"},"确认删除这条留言吗？")],-1))]),_:1}),(0,a.createVNode)(x,{align:"right"},{default:(0,a.withCtx)(()=>[(0,a.withDirectives)((0,a.createVNode)(s,{flat:"",label:"确认",color:"negative",onClick:t=>h(e)},null,8,["onClick"]),[[q]]),(0,a.withDirectives)((0,a.createVNode)(s,{flat:"",label:"取消",color:"primary"},null,512),[[q]])]),_:2},1024)]),_:2},1024)]),_:2},1024),(0,a.createVNode)(R,null,{default:(0,a.withCtx)(()=>[...r[3]||(r[3]=[(0,a.createTextVNode)("删除",-1)])]),_:1})]),_:2},1024),(0,a.createVNode)(s,{size:"md",color:"positive",icon:"check",dense:"",onClick:t=>N(e)},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(R,null,{default:(0,a.withCtx)(()=>[...r[4]||(r[4]=[(0,a.createTextVNode)("通过审核",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading"]),(0,a.createElementVNode)("div",m,[(0,a.createVNode)(A,{modelValue:n.value.page,"onUpdate:modelValue":[r[0]||(r[0]=e=>n.value.page=e),w],max:Math.ceil(n.value.total/n.value.rowsPerPage),"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max"]),(0,a.createVNode)(P,{modelValue:n.value.rowsPerPage,"onUpdate:modelValue":[r[1]||(r[1]=e=>n.value.rowsPerPage=e),v],options:[10,15,20,30,50,100,200],dense:"",outlined:"",class:"q-ml-md",style:{width:"80px"}},null,8,["modelValue"]),(0,a.createElementVNode)("span",C,"共 "+(0,a.toDisplayString)(n.value.total)+" 条",1)])]),_:1})]),_:1})])}}}),g=o(1317),v=o(3663),w=o(7180),h=o(407),N=o(7877),V=o(4854),x=o(4503),b=o(1248),k=o(6997),R=o(4183),y=o(975),_=o(515),A=o(2110),P=o.n(A);const q=(0,g.A)(f,[["__scopeId","data-v-71271d3e"]]);var E=q;P()(f,"components",{QCard:v.A,QCardSection:w.A,QBtn:h.A,QBtnGroup:N.A,QPopupProxy:V.A,QIcon:x.A,QCardActions:b.A,QTooltip:k.A,QPagination:R.A,QSelect:y.A}),P()(f,"directives",{ClosePopup:_.A})},3986:function(e,t,o){"use strict";var a=o(3719),r=o.n(a),s=o(7454),n=o.n(s),l=o(6661),i=o(7695);const c=r().create({baseURL:l.c.baseURL,timeout:l.c.timeOut});c.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=n().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),c.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&i.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return i.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:i.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:i.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:i.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:i.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:i.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:i.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:i.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:i.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:i.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:i.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=c}}]);