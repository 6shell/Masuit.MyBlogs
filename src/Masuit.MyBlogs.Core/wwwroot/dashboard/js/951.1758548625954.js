(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[951],{13986:function(e,t,o){"use strict";var a=o(74413),s=o(27454),r=o.n(s),l=o(76661),n=o(57695);const i=a.A.create({baseURL:l.c.baseURL,timeout:l.c.timeOut});i.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=r().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&n.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return n.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:n.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:n.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:n.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:n.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:n.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:n.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:n.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:n.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:n.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:n.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=i},28714:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return L}});var a=o(74220),s=o(97700),r=o(46732),l=o(57695),n=o(13986),i=(o(26960),o(243));const c={class:"email-templates-page"},u={key:0,class:"text-center q-pa-xl"},p={key:1,class:"row q-gutter-md"},d=["title"],v={class:"text-h6"},m={key:0},k={key:1},b=["innerHTML"];var f=(0,a.pM)({__name:"email-templates",setup(e){const t=(0,r.KR)([]),o=(0,r.KR)(null),f=(0,r.KR)(!1),g=(0,r.KR)(""),C=(0,r.KR)(""),R=(0,r.KR)(""),y=(0,r.KR)(!1),h=(0,r.KR)(!1),w=(0,r.KR)(!1),q=(0,r.KR)();let A=null;const F=async()=>{w.value=!0;try{const e=await n.A.get("/file/Getfiles?path=\\template");e?.Success&&e.Data?t.value=e.Data:l.oR.error("获取邮件模板列表失败",{autoClose:2e3,position:"top-center"})}catch(e){l.oR.error("获取邮件模板列表失败",{autoClose:2e3,position:"top-center"}),console.error("Error getting template files:",e)}finally{w.value=!1}},_=async e=>{try{const t=await n.A.post("/file/read",{filename:e});t?.Success&&t.Data?(g.value=e.split("\\").pop()||e,C.value=e,R.value=t.Data,f.value=!0,y.value=!1):l.oR.error("读取邮件模板失败",{autoClose:2e3,position:"top-center"})}catch(t){l.oR.error("读取邮件模板失败",{autoClose:2e3,position:"top-center"}),console.error("Error viewing template:",t)}},E=async()=>{y.value=!y.value,y.value?(await(0,a.dY)(),x()):A&&(R.value=A.getValue())},x=()=>{q.value&&!A?A=i.EN.create(q.value,{value:R.value,language:"html",theme:"vs",minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on"}):A&&A.setValue(R.value)},L=async()=>{if(A){h.value=!0;try{const e=A.getValue(),t=await n.A.post("/file/save",{filename:C.value,content:e});t?.Success?(R.value=e,l.oR.success("邮件模板保存成功",{autoClose:2e3,position:"top-center"})):l.oR.error(t?.Message||"保存失败",{autoClose:2e3,position:"top-center"}),E()}catch(e){l.oR.error("保存失败",{autoClose:2e3,position:"top-center"}),console.error("Error saving template:",e)}finally{h.value=!1}}},K=()=>{f.value=!1,g.value="",C.value="",R.value="",y.value=!1,A&&(A.dispose(),A=null)};return(0,a.sV)(()=>{F()}),(0,a.hi)(()=>{A&&A.dispose()}),(e,r)=>{const l=(0,a.g2)("q-icon"),n=(0,a.g2)("q-card-section"),i=(0,a.g2)("q-card"),C=(0,a.g2)("q-space"),w=(0,a.g2)("q-btn"),A=(0,a.g2)("q-btn-group"),F=(0,a.g2)("q-scroll-area"),x=(0,a.g2)("q-dialog");return(0,a.uX)(),(0,a.CE)("div",c,[r[3]||(r[3]=(0,a.Lk)("div",{class:"text-h4 q-mb-md"},"模板管理",-1)),(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)(n,null,{default:(0,a.k6)(()=>[0===t.value.length?((0,a.uX)(),(0,a.CE)("div",u,[(0,a.bF)(l,{name:"email",size:"4rem",color:"grey-5"}),r[2]||(r[2]=(0,a.Lk)("div",{class:"text-h6 text-grey-7 q-mt-md"},"暂无模板文件",-1))])):((0,a.uX)(),(0,a.CE)("div",p,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.value,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.path,class:"col-md-2 col-sm-3 col-xs-4"},[(0,a.bF)(i,{class:(0,s.C4)(["file-card cursor-pointer",{"file-card-hover":o.value===e.path}]),onDblclick:t=>_(e.path),onMouseenter:t=>o.value=e.path,onMouseleave:r[0]||(r[0]=e=>o.value=null)},{default:(0,a.k6)(()=>[(0,a.bF)(n,{class:"text-center q-pa-md"},{default:(0,a.k6)(()=>[(0,a.bF)(l,{name:"email",size:"3rem",color:"primary",class:"q-mb-sm"}),(0,a.Lk)("div",{class:"text-body2 text-weight-medium file-name",title:e.filename},(0,s.v_)(e.filename),9,d)]),_:2},1024)]),_:2},1032,["onDblclick","class","onMouseenter"])]))),128))]))]),_:1})]),_:1}),(0,a.bF)(x,{modelValue:f.value,"onUpdate:modelValue":r[1]||(r[1]=e=>f.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:(0,a.k6)(()=>[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)(n,{class:"row items-center q-pb-none"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",v,(0,s.v_)(g.value),1),(0,a.bF)(C),(0,a.bF)(A,null,{default:(0,a.k6)(()=>[y.value?((0,a.uX)(),(0,a.Wv)(w,{key:0,color:"primary",icon:"save",label:"保存",onClick:L,loading:h.value},null,8,["loading"])):(0,a.Q3)("",!0),(0,a.bF)(w,{color:"secondary",icon:y.value?"visibility":"edit",label:y.value?"预览":"编辑",onClick:E},null,8,["icon","label"]),(0,a.bF)(w,{icon:"close",flat:"",round:"",dense:"",onClick:K})]),_:1})]),_:1}),(0,a.bF)(n,{class:"q-pt-none"},{default:(0,a.k6)(()=>[y.value?((0,a.uX)(),(0,a.CE)("div",m,[(0,a.Lk)("div",{ref_key:"templateEditor",ref:q,class:"template-editor"},null,512)])):((0,a.uX)(),(0,a.CE)("div",k,[(0,a.bF)(F,{style:{height:"70vh"}},{default:(0,a.k6)(()=>[(0,a.Lk)("div",{class:"template-preview",innerHTML:R.value},null,8,b)]),_:1})]))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),g=o(1317),C=o(63663),R=o(17180),y=o(64503),h=o(51375),w=o(25915),q=o(10258),A=o(20407),F=o(30196),_=o(22110),E=o.n(_);const x=(0,g.A)(f,[["__scopeId","data-v-34c4c14c"]]);var L=x;E()(f,"components",{QCard:C.A,QCardSection:R.A,QIcon:y.A,QDialog:h.A,QSpace:w.A,QBtnGroup:q.A,QBtn:A.A,QScrollArea:F.A})},42634:function(){}}]);