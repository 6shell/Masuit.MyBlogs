(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[434],{253:function(){},1622:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return I}});var a=o(4061),l=o(7695),r=o(3986);const n={class:"values-page"},s={class:"row q-mb-md"},i={class:"col text-right"},c={class:"text-h6 q-mb-md"},d={key:0,class:"text-center q-pa-xl text-grey-6"},u={key:1},m={class:"row items-center justify-between q-mb-md"},p={class:"col-auto"},v={class:"text-body2 text-grey-7"},b={class:"col-auto"},g=["innerHTML"],V={key:0,class:"row justify-center q-mt-md"},f={class:"text-h6"},h={class:"q-gutter-md"},C={class:"row items-center"},w={class:"col-auto"},k={key:0,class:"editor-container"},N={key:1,class:"editor-container"};var y=(0,a.defineComponent)({__name:"values",setup(e){const t=(0,a.ref)([]),o=(0,a.ref)(!1),y=(0,a.ref)(!1),x=(0,a.ref)([{data:""}]),q=(0,a.ref)(1),E=(0,a.ref)(10),A=[{label:"5条/页",value:5},{label:"10条/页",value:10},{label:"20条/页",value:20},{label:"50条/页",value:50}],R=(0,a.ref)(!1),B=(0,a.ref)(!1),_=(0,a.ref)({Key:"",Value:""}),Q=(0,a.ref)(!1),M={autoHeightEnabled:!1,initialFrameHeight:300,initialFrameWidth:"100%",zIndex:99,toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","simpleupload","insertimage","emotion","scrawl","insertvideo","music","attachment","map","gmap","insertframe","insertcode","webapp","pagebreak","template","background","|","horizontal","date","time","spechars","snapscreen","wordimage","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","charts","|","print","preview","searchreplace","drafts","help"]]},j=["browser","os","clientip","location","network"],S={toolbars:["bold","italic","strikethrough","|","title","quote","unorderedList","orderedList","task","|","codeRow","code","link","image","table","|","hr","br","|","preview","fullscreen"]},T=(0,a.computed)(()=>Math.ceil(t.value.length/E.value)),U=(0,a.computed)(()=>{const e=(q.value-1)*E.value,o=e+E.value;return t.value.slice(e,o)}),D=e=>{q.value=e},K=e=>{E.value=e,q.value=1},L=e=>e?/^[a-zA-Z]/.test(e)?j.includes(e.toLowerCase())?"不能使用系统保留变量名":!(!B.value&&t.value.some(t=>t.Key===e))||"变量名已存在":"变量名必须以字母开头":"请输入变量名",O=async()=>{o.value=!0;try{const e=await r.A.get("/values/list");e?.Data&&Array.isArray(e.Data)?t.value=e.Data:t.value=[]}catch(e){l.oR.error("加载变量列表失败",{autoClose:2e3,position:"top-center"}),console.error("Error loading variables:",e),t.value=[]}finally{o.value=!1}},z=()=>{_.value={Key:"",Value:""},B.value=!1,Q.value=!1,R.value=!0},H=e=>{_.value={...e},B.value=!0,R.value=!0},I=()=>{R.value=!1},P=async()=>{const e=L(_.value.Key);if(!0===e)if(_.value.Key){y.value=!0;try{const e=await r.A.post("/values",_.value);!1!==e?.Success?(l.oR.success(e?.Message||"保存成功",{autoClose:2e3,position:"top-center"}),I(),setTimeout(()=>{O()},500)):l.oR.error(e?.Message||"保存失败",{autoClose:2e3,position:"top-center"})}catch(t){l.oR.error("保存失败",{autoClose:2e3,position:"top-center"}),console.error("Error saving variable:",t)}finally{y.value=!1}}else l.oR.warning("请输入变量名",{autoClose:2e3,position:"top-center"});else l.oR.warning(e,{autoClose:2e3,position:"top-center"})};return(0,a.onMounted)(()=>{O()}),(e,l)=>{const r=(0,a.resolveComponent)("q-btn"),j=(0,a.resolveComponent)("q-btn-group"),F=(0,a.resolveComponent)("q-icon"),$=(0,a.resolveComponent)("q-banner"),G=(0,a.resolveComponent)("q-chip"),J=(0,a.resolveComponent)("q-select"),W=(0,a.resolveComponent)("vxe-column"),Z=(0,a.resolveComponent)("vxe-table"),X=(0,a.resolveComponent)("q-pagination"),Y=(0,a.resolveComponent)("q-card-section"),ee=(0,a.resolveComponent)("q-card"),te=(0,a.resolveComponent)("q-space"),oe=(0,a.resolveComponent)("q-input"),ae=(0,a.resolveComponent)("q-toggle"),le=(0,a.resolveComponent)("vue-ueditor-wrap"),re=(0,a.resolveComponent)("v-md-editor"),ne=(0,a.resolveComponent)("q-card-actions"),se=(0,a.resolveComponent)("q-dialog");return(0,a.openBlock)(),(0,a.createElementBlock)("div",n,[(0,a.createElementVNode)("div",s,[l[7]||(l[7]=(0,a.createElementVNode)("div",{class:"col text-h6"}," 系统变量管理 ",-1)),(0,a.createElementVNode)("div",i,[(0,a.createVNode)(j,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(r,{color:"primary",icon:"refresh",label:"刷新",onClick:O,loading:o.value},null,8,["loading"]),(0,a.createVNode)(r,{color:"positive",icon:"add",label:"添加变量",onClick:z})]),_:1})])]),(0,a.createVNode)($,{class:"bg-warning text-white q-mb-md",rounded:""},{avatar:(0,a.withCtx)(()=>[(0,a.createVNode)(F,{name:"warning"})]),default:(0,a.withCtx)(()=>[l[8]||(l[8]=(0,a.createElementVNode)("div",{class:"text-body2"},[(0,a.createElementVNode)("p",{class:"q-mb-xs"},[(0,a.createElementVNode)("strong",null,"温馨提示：")]),(0,a.createElementVNode)("p",{class:"q-mb-xs"},"1. 变量支持关联引用，请注意不要造成循环引用！"),(0,a.createElementVNode)("p",{class:"q-mb-xs"},"2. 关联引用层级不要太多，避免造成递归查找时的性能问题！"),(0,a.createElementVNode)("p",{class:"q-mb-none"},"3. 请不要使用如下系统变量名作为变量名：browser(浏览器版本)、os(操作系统)、clientip(客户端ip)、location(客户端地理位置)、network(客户端网络信息)")],-1))]),_:1}),(0,a.createVNode)(ee,{flat:"",bordered:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(Y,null,{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",c,[(0,a.createVNode)(F,{name:"settings",class:"q-mr-sm"}),l[9]||(l[9]=(0,a.createTextVNode)(" 变量列表 ",-1)),t.value.length>0?((0,a.openBlock)(),(0,a.createBlock)(G,{key:0,color:"primary","text-color":"white",label:`共 ${t.value.length} 个变量`,class:"q-ml-sm"},null,8,["label"])):(0,a.createCommentVNode)("",!0)]),0!==t.value.length||o.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",u,[(0,a.createElementVNode)("div",m,[(0,a.createElementVNode)("div",p,[(0,a.createElementVNode)("span",v," 共 "+(0,a.toDisplayString)(t.value.length)+" 条记录，当前显示第 "+(0,a.toDisplayString)((q.value-1)*E.value+1)+" - "+(0,a.toDisplayString)(Math.min(q.value*E.value,t.value.length))+" 条 ",1)]),(0,a.createElementVNode)("div",b,[(0,a.createVNode)(J,{modelValue:E.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>E.value=e),K],options:A,dense:"",outlined:"",label:"每页显示",style:{"min-width":"120px"}},null,8,["modelValue"])])]),(0,a.createVNode)(Z,{data:U.value,border:"",stripe:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(W,{field:"Key",title:"变量名",width:"200",filters:x.value,"filter-render":{name:"input"}},null,8,["filters"]),(0,a.createVNode)(W,{field:"Value",title:"变量值",filters:x.value,"filter-render":{name:"input"}},{default:(0,a.withCtx)(({row:e})=>[(0,a.createElementVNode)("div",{class:"variable-value",innerHTML:e.Value},null,8,g)]),_:1},8,["filters"]),(0,a.createVNode)(W,{title:"操作",width:"100",align:"center",fixed:"right"},{default:(0,a.withCtx)(({row:e})=>[(0,a.createVNode)(r,{flat:"",dense:"",color:"green",icon:"edit",onClick:t=>H(e)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),T.value>1?((0,a.openBlock)(),(0,a.createElementBlock)("div",V,[(0,a.createVNode)(X,{modelValue:q.value,"onUpdate:modelValue":[l[1]||(l[1]=e=>q.value=e),D],max:T.value,"max-pages":6,"direction-links":"","boundary-links":"",color:"primary"},null,8,["modelValue","max"])])):(0,a.createCommentVNode)("",!0)])):((0,a.openBlock)(),(0,a.createElementBlock)("div",d,[(0,a.createVNode)(F,{name:"settings_outline",size:"64px",class:"q-mb-md"}),l[10]||(l[10]=(0,a.createElementVNode)("div",{class:"text-h6"},"暂无系统变量",-1)),l[11]||(l[11]=(0,a.createElementVNode)("div",{class:"text-body2 q-mt-sm"},'点击上方"添加变量"按钮创建第一个变量',-1))]))]),_:1})]),_:1}),(0,a.createVNode)(se,{modelValue:R.value,"onUpdate:modelValue":l[6]||(l[6]=e=>R.value=e),persistent:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(ee,{style:{"min-width":"800px","max-width":"90vw"}},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(Y,{class:"row items-center q-pb-none"},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",f,(0,a.toDisplayString)(B.value?"修改变量":"添加变量"),1),(0,a.createVNode)(te),(0,a.createVNode)(r,{icon:"close",flat:"",round:"",dense:"",onClick:I})]),_:1}),(0,a.createVNode)(Y,null,{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",h,[(0,a.createVNode)(oe,{modelValue:_.value.Key,"onUpdate:modelValue":l[2]||(l[2]=e=>_.value.Key=e),label:"变量名",hint:"以字母开头，请勿使用系统变量名：browser、os、clientip、location、network",dense:"",outlined:"",required:"",disable:B.value,rules:[L]},null,8,["modelValue","disable","rules"]),(0,a.createElementVNode)("div",C,[l[12]||(l[12]=(0,a.createElementVNode)("div",{class:"col-auto text-subtitle2"},"编辑器类型：",-1)),(0,a.createElementVNode)("div",w,[(0,a.createVNode)(ae,{modelValue:Q.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Q.value=e),label:Q.value?"Markdown编辑器":"UEditor富文本编辑器",color:"primary"},null,8,["modelValue","label"])])]),(0,a.createElementVNode)("div",null,[l[13]||(l[13]=(0,a.createElementVNode)("div",{class:"text-subtitle2 q-mb-sm"},"变量值：",-1)),Q.value?((0,a.openBlock)(),(0,a.createElementBlock)("div",N,[(0,a.createVNode)(re,{modelValue:_.value.Value,"onUpdate:modelValue":l[5]||(l[5]=e=>_.value.Value=e),height:"300px",placeholder:"请输入专题描述（支持 Markdown 语法）","toolbar-config":S},null,8,["modelValue"])])):((0,a.openBlock)(),(0,a.createElementBlock)("div",k,[(0,a.createVNode)(le,{modelValue:_.value.Value,"onUpdate:modelValue":l[4]||(l[4]=e=>_.value.Value=e),config:M,"editor-id":"variable-ueditor"},null,8,["modelValue"])]))])])]),_:1}),(0,a.createVNode)(ne,{align:"right"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(r,{flat:"",label:"取消",onClick:I}),(0,a.createVNode)(r,{color:"primary",label:B.value?"保存修改":"确认添加",onClick:P,loading:y.value,disable:!_.value.Key},null,8,["label","loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),x=o(1317),q=o(7877),E=o(407),A=o(4959),R=o(4503),B=o(3663),_=o(7180),Q=o(7491),M=o(975),j=o(4183),S=o(1375),T=o(5915),U=o(8622),D=o(1343),K=o(1248),L=o(9754),O=o(2110),z=o.n(O);const H=(0,x.A)(y,[["__scopeId","data-v-293067ac"]]);var I=H;z()(y,"components",{QBtnGroup:q.A,QBtn:E.A,QBanner:A.A,QIcon:R.A,QCard:B.A,QCardSection:_.A,QChip:Q.A,QSelect:M.A,QPagination:j.A,QDialog:S.A,QSpace:T.A,QInput:U.A,QToggle:D.A,QCardActions:K.A,QTable:L.A})},3986:function(e,t,o){"use strict";var a=o(3719),l=o.n(a),r=o(7454),n=o.n(r),s=o(6661),i=o(7695);const c=l().create({baseURL:s.c.baseURL,timeout:s.c.timeOut});c.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=n().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),c.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&i.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return i.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:i.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:i.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:i.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:i.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:i.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:i.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:i.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:i.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:i.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:i.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=c}}]);