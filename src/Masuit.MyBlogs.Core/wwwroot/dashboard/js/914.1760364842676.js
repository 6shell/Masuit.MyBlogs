(self["webpackChunk"]=self["webpackChunk"]||[]).push([[914],{253:function(){},3986:function(e,t,o){"use strict";var a=o(3719),r=o.n(a),n=o(7454),i=o.n(n),s=o(6661),l=o(7695);const c=r().create({baseURL:s.c.baseURL,timeout:s.c.timeOut});c.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=i().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),c.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&l.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return l.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:l.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:l.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:l.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:l.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:l.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:l.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:l.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:l.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:l.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:l.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=c},6569:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return A}});var a=o(4061),r=o(7695),n=o(3508),i=o.n(n),s=o(3986);const l={class:"donate-list-container"},c={class:"q-mt-md"},d={class:"q-gutter-xs"};var u=(0,a.defineComponent)({__name:"index",setup(e){const t=(0,a.ref)(!1),o=(0,a.ref)(!1),n=(0,a.ref)([]),u=(0,a.ref)(),p=(0,a.ref)(new Map),m=(0,a.ref)({page:1,rowsPerPage:10,total:0}),f=async()=>{t.value=!0;try{const e={page:m.value.page,size:m.value.rowsPerPage},t=await s.A.post("/donate/getpagedata",null,{params:e});t&&(n.value=(t.Data||[]).map(e=>({...e,DonateTime:i()(e.DonateTime).format("YYYY-MM-DD HH:mm:ss")})),m.value.total=t.TotalCount||0)}catch(e){r.oR.error("加载数据失败",{autoClose:2e3,position:"top-center"})}finally{t.value=!1}},C=({pageSize:e,currentPage:t})=>{m.value.page=t,m.value.rowsPerPage=e,f()},g=async()=>{const e=u.value;if(!e)return;if(e.getEditRecords&&e.getEditRecords().length>0)return void r.oR.info("请先保存或取消当前编辑行",{autoClose:2e3,position:"top-center"});const t={Id:0,NickName:"",DonateTime:i()().format("YYYY-MM-DD HH:mm:ss"),Amount:"",Via:"",Email:"",QQorWechat:""},{row:o}=await e.insertAt(t,0);e.setEditRow(o),p.value.set(0,{...t,Id:0})},w=async(e,t)=>{if(e.NickName&&e.Amount&&e.Via)try{const o=await s.A.post("/donate/save",e);o?.Success?(r.oR.success(o.Message||"保存成功",{autoClose:2e3,position:"top-center"}),t.clearEdit(),await f()):r.oR.error(o?.Message||"保存失败",{autoClose:2e3,position:"top-center"})}catch(o){r.oR.error("保存失败",{autoClose:2e3,position:"top-center"})}else r.oR.warning("请填写必填字段：昵称/金额/打赏方式",{autoClose:2e3,position:"top-center"})},v=(e,t)=>{if(null==e.Id){const t=n.value.indexOf(e);t>-1&&n.value.splice(t,1)}else{const t=p.value.get(e.Id);t&&Object.assign(e,t)}t.clearEdit()},h=async e=>{if(e){o.value=!0;try{const t=await s.A.post(`/donate/delete/${e}`);!1!==t?.Success?(r.oR.success(t?.Message||"删除成功",{autoClose:2e3,position:"top-center"}),await f()):r.oR.error(t?.Message||"删除失败",{autoClose:2e3,position:"top-center"})}catch(t){r.oR.error("删除失败",{autoClose:2e3,position:"top-center"})}finally{o.value=!1}}};return(0,a.onMounted)(()=>{f()}),(e,o)=>{const r=(0,a.resolveComponent)("q-btn"),i=(0,a.resolveComponent)("q-btn-group"),s=(0,a.resolveComponent)("vxe-column"),p=(0,a.resolveComponent)("q-tooltip"),N=(0,a.resolveComponent)("q-icon"),V=(0,a.resolveComponent)("q-card-section"),x=(0,a.resolveComponent)("q-card-actions"),k=(0,a.resolveComponent)("q-card"),R=(0,a.resolveComponent)("q-popup-proxy"),b=(0,a.resolveComponent)("vxe-table"),y=(0,a.resolveComponent)("vxe-pager"),A=(0,a.resolveDirective)("close-popup");return(0,a.openBlock)(),(0,a.createElementBlock)("div",l,[(0,a.createVNode)(k,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(V,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(i,{push:""},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(r,{color:"primary",icon:"add",onClick:g},{default:(0,a.withCtx)(()=>[...o[0]||(o[0]=[(0,a.createTextVNode)(" 添加打赏记录 ",-1)])]),_:1}),(0,a.createVNode)(r,{color:"info",icon:"refresh",onClick:f,loading:t.value},{default:(0,a.withCtx)(()=>[...o[1]||(o[1]=[(0,a.createTextVNode)(" 刷新 ",-1)])]),_:1},8,["loading"])]),_:1}),(0,a.createElementVNode)("div",c,[(0,a.createVNode)(b,{ref_key:"tableRef",ref:u,data:n.value,loading:t.value,stripe:"",border:"","show-header-overflow":"","show-overflow":"","edit-config":{trigger:"manual",mode:"row"}},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(s,{field:"DonateTime",title:"打赏时间",width:"160",fixed:"left","edit-render":{name:"VxeInput",props:{type:"date"}},formatter:"formatDate"}),(0,a.createVNode)(s,{field:"NickName",title:"昵称","min-width":"140","edit-render":{name:"VxeInput"}}),(0,a.createVNode)(s,{field:"Amount",title:"金额",width:"110","edit-render":{name:"VxeInput"}}),(0,a.createVNode)(s,{field:"Via",title:"打赏方式",width:"140","edit-render":{name:"VxeInput"}}),(0,a.createVNode)(s,{field:"Email",title:"Email","min-width":"200","edit-render":{name:"VxeInput",props:{type:"email"}}}),(0,a.createVNode)(s,{field:"QQorWechat",title:"QQ或微信",width:"160","edit-render":{name:"VxeInput"}}),(0,a.createVNode)(s,{title:"操作",width:"130",fixed:"right",align:"center"},{default:(0,a.withCtx)(({row:e,$table:n})=>[(0,a.createElementVNode)("div",d,[n.isEditByRow(e)?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[(0,a.createVNode)(r,{color:"primary",icon:"check",size:"sm",dense:"",flat:"",loading:t.value,onClick:t=>w(e,n)},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(p,null,{default:(0,a.withCtx)(()=>[...o[2]||(o[2]=[(0,a.createTextVNode)("保存",-1)])]),_:1})]),_:1},8,["loading","onClick"]),(0,a.createVNode)(r,{color:"grey",icon:"close",size:"sm",dense:"",flat:"",onClick:t=>v(e,n)},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(p,null,{default:(0,a.withCtx)(()=>[...o[3]||(o[3]=[(0,a.createTextVNode)("取消",-1)])]),_:1})]),_:1},8,["onClick"])],64)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createVNode)(r,{color:"info",icon:"edit",size:"sm",dense:"",flat:"",onClick:t=>n.setEditRow(e)},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(p,null,{default:(0,a.withCtx)(()=>[...o[4]||(o[4]=[(0,a.createTextVNode)("编辑",-1)])]),_:1})]),_:1},8,["onClick"]),(0,a.createVNode)(r,{color:"negative",icon:"delete",size:"sm",dense:"",flat:"",disable:0===e.Id||null==e.Id},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(p,null,{default:(0,a.withCtx)(()=>[...o[5]||(o[5]=[(0,a.createTextVNode)("删除",-1)])]),_:1}),(0,a.createVNode)(R,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(k,null,{default:(0,a.withCtx)(()=>[(0,a.createVNode)(V,{class:"row items-center"},{default:(0,a.withCtx)(()=>[(0,a.createVNode)(N,{name:"warning",color:"red",size:"2rem",class:"q-mr-sm"}),o[6]||(o[6]=(0,a.createElementVNode)("div",null,[(0,a.createElementVNode)("div",{class:"text-h6"},"确认删除"),(0,a.createElementVNode)("div",{class:"text-subtitle2"},"确认删除这条打赏记录吗？")],-1))]),_:1}),(0,a.createVNode)(x,{align:"right"},{default:(0,a.withCtx)(()=>[(0,a.withDirectives)((0,a.createVNode)(r,{flat:"",label:"确认",color:"negative",onClick:t=>h(e.Id)},null,8,["onClick"]),[[A]]),(0,a.withDirectives)((0,a.createVNode)(r,{flat:"",label:"取消",color:"primary"},null,512),[[A]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["disable"])],64))])]),_:1})]),_:1},8,["data","loading"]),(0,a.createVNode)(y,{"current-page":m.value.page,total:m.value.total,"page-size":m.value.rowsPerPage,onPageChange:C},null,8,["current-page","total","page-size"])])]),_:1})]),_:1})])}}}),p=o(1317),m=o(3663),f=o(7180),C=o(7877),g=o(407),w=o(6997),v=o(4854),h=o(4503),N=o(1248),V=o(5855),x=o(4183),k=o(515),R=o(2110),b=o.n(R);const y=(0,p.A)(u,[["__scopeId","data-v-3a654462"]]);var A=y;b()(u,"components",{QCard:m.A,QCardSection:f.A,QBtnGroup:C.A,QBtn:g.A,QTooltip:w.A,QPopupProxy:v.A,QIcon:h.A,QCardActions:N.A,QField:V.A,QPagination:x.A}),b()(u,"directives",{ClosePopup:k.A})}}]);