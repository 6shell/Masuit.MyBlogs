(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[63],{253:function(){},1474:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return A}});var r=o(4061),a=o(7695),n=o(3986),l=o(3100);const s={class:"email-templates-page"},c={key:0,class:"text-center q-pa-xl"},i={key:1,class:"row q-gutter-md"},u=["title"],d={class:"text-h6"},p={key:0},m={key:1},v=["innerHTML"];var f=(0,r.defineComponent)({__name:"email-templates",setup(e){const t=(0,r.ref)([]),o=(0,r.ref)(null),f=(0,r.ref)(!1),C=(0,r.ref)(""),h=(0,r.ref)(""),k=(0,r.ref)(""),w=(0,r.ref)(!1),b=(0,r.ref)(!1),y=(0,r.ref)(!1),g=(0,r.ref)();let N=null;const x=()=>{if(N){const e=N.getWrapperElement?.();e&&e.parentNode&&e.parentNode.removeChild(e),N=null}g.value&&(g.value.innerHTML="")},R=async()=>{y.value=!0;try{const e=await n.A.get("/file/Getfiles?path=\\template");e?.Success&&e.Data?t.value=e.Data:a.oR.error("获取邮件模板列表失败",{autoClose:2e3,position:"top-center"})}catch(e){a.oR.error("获取邮件模板列表失败",{autoClose:2e3,position:"top-center"}),console.error("Error getting template files:",e)}finally{y.value=!1}},V=async e=>{try{const t=await n.A.post("/file/read",{filename:e});t?.Success&&t.Data?(C.value=e.split("\\").pop()||e,h.value=e,k.value=t.Data,f.value=!0,w.value=!1):a.oR.error("读取邮件模板失败",{autoClose:2e3,position:"top-center"})}catch(t){a.oR.error("读取邮件模板失败",{autoClose:2e3,position:"top-center"}),console.error("Error viewing template:",t)}},E=async()=>{if(w.value)return N&&(k.value=N.getValue()),w.value=!1,void x();try{await(0,l.A)(),w.value=!0,await(0,r.nextTick)(),A()}catch(e){a.oR.error("编辑器初始化失败",{autoClose:2e3,position:"top-center"}),console.error("Error loading CodeMirror assets:",e)}},A=()=>{if(!g.value)return;x();const e=window.CodeMirror;e&&(N=e(g.value,{value:k.value,lineNumbers:!0,mode:"htmlmixed"}))},B=async()=>{if(N){b.value=!0;try{const e=N.getValue(),t=await n.A.post("/file/save",{filename:h.value,content:e});t?.Success?(k.value=e,a.oR.success("邮件模板保存成功",{autoClose:2e3,position:"top-center"})):a.oR.error(t?.Message||"保存失败",{autoClose:2e3,position:"top-center"}),E()}catch(e){a.oR.error("保存失败",{autoClose:2e3,position:"top-center"}),console.error("Error saving template:",e)}finally{b.value=!1}}},q=()=>{f.value=!1,C.value="",h.value="",k.value="",w.value=!1,x()};return(0,r.onMounted)(()=>{R()}),(0,r.onUnmounted)(()=>{x()}),(e,a)=>{const n=(0,r.resolveComponent)("q-icon"),l=(0,r.resolveComponent)("q-card-section"),h=(0,r.resolveComponent)("q-card"),y=(0,r.resolveComponent)("q-space"),N=(0,r.resolveComponent)("q-btn"),x=(0,r.resolveComponent)("q-btn-group"),R=(0,r.resolveComponent)("q-scroll-area"),A=(0,r.resolveComponent)("q-dialog");return(0,r.openBlock)(),(0,r.createElementBlock)("div",s,[a[3]||(a[3]=(0,r.createElementVNode)("div",{class:"text-h4 q-mb-md"},"模板管理",-1)),(0,r.createVNode)(h,null,{default:(0,r.withCtx)(()=>[(0,r.createVNode)(l,null,{default:(0,r.withCtx)(()=>[0===t.value.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",c,[(0,r.createVNode)(n,{name:"email",size:"4rem",color:"grey-5"}),a[2]||(a[2]=(0,r.createElementVNode)("div",{class:"text-h6 text-grey-7 q-mt-md"},"暂无模板文件",-1))])):((0,r.openBlock)(),(0,r.createElementBlock)("div",i,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(t.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.path,class:"col-md-2 col-sm-3 col-xs-4"},[(0,r.createVNode)(h,{class:(0,r.normalizeClass)(["file-card cursor-pointer",{"file-card-hover":o.value===e.path}]),onDblclick:t=>V(e.path),onMouseenter:t=>o.value=e.path,onMouseleave:a[0]||(a[0]=e=>o.value=null)},{default:(0,r.withCtx)(()=>[(0,r.createVNode)(l,{class:"text-center q-pa-md"},{default:(0,r.withCtx)(()=>[(0,r.createVNode)(n,{name:"email",size:"3rem",color:"primary",class:"q-mb-sm"}),(0,r.createElementVNode)("div",{class:"text-body2 text-weight-medium file-name",title:e.filename},(0,r.toDisplayString)(e.filename),9,u)]),_:2},1024)]),_:2},1032,["onDblclick","class","onMouseenter"])]))),128))]))]),_:1})]),_:1}),(0,r.createVNode)(A,{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:(0,r.withCtx)(()=>[(0,r.createVNode)(h,null,{default:(0,r.withCtx)(()=>[(0,r.createVNode)(l,{class:"row items-center q-pb-none"},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)("div",d,(0,r.toDisplayString)(C.value),1),(0,r.createVNode)(y),(0,r.createVNode)(x,null,{default:(0,r.withCtx)(()=>[w.value?((0,r.openBlock)(),(0,r.createBlock)(N,{key:0,color:"primary",icon:"save",label:"保存",onClick:B,loading:b.value},null,8,["loading"])):(0,r.createCommentVNode)("",!0),(0,r.createVNode)(N,{color:"secondary",icon:w.value?"visibility":"edit",label:w.value?"预览":"编辑",onClick:E},null,8,["icon","label"]),(0,r.createVNode)(N,{icon:"close",flat:"",round:"",dense:"",onClick:q})]),_:1})]),_:1}),(0,r.createVNode)(l,{class:"q-pt-none"},{default:(0,r.withCtx)(()=>[w.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",p,[(0,r.createElementVNode)("div",{ref_key:"templateEditor",ref:g,class:"template-editor"},null,512)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",m,[(0,r.createVNode)(R,{style:{height:"70vh"}},{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)("div",{class:"template-preview",innerHTML:k.value},null,8,v)]),_:1})]))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),C=o(1317),h=o(3663),k=o(7180),w=o(4503),b=o(1375),y=o(5915),g=o(7877),N=o(407),x=o(196),R=o(2110),V=o.n(R);const E=(0,C.A)(f,[["__scopeId","data-v-71959f9a"]]);var A=E;V()(f,"components",{QCard:h.A,QCardSection:k.A,QIcon:w.A,QDialog:b.A,QSpace:y.A,QBtnGroup:g.A,QBtn:N.A,QScrollArea:x.A})},3100:function(e,t,o){"use strict";let r=null,a=!1;const n=async()=>{a||(await Promise.all([o.e(504).then(o.t.bind(o,7401,23)),o.e(504).then(o.t.bind(o,689,23)),o.e(504).then(o.t.bind(o,1425,23)),o.e(504).then(o.t.bind(o,8513,23))]),a=!0)},l=async()=>r||(r=o.e(504).then(o.t.bind(o,2276,23)).then(e=>{const t=e.default??e;return window.CodeMirror=t,t}).then(async e=>(e?.modes?.htmlmixed||await n(),e)).catch(e=>{throw r=null,e}),r),s=async()=>{if(window.CodeMirror?.modes?.htmlmixed)return window.CodeMirror;const e=await l();return e?.modes?.htmlmixed||await n(),e};t.A=s},3986:function(e,t,o){"use strict";var r=o(3719),a=o.n(r),n=o(7454),l=o.n(n),s=o(6661),c=o(7695);const i=a().create({baseURL:s.c.baseURL,timeout:s.c.timeOut});i.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=l().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&c.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return c.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:c.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:c.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:c.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:c.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:c.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:c.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:c.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:c.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:c.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:c.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=i}}]);