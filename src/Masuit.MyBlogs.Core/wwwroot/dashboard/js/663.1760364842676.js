(self["webpackChunk"]=self["webpackChunk"]||[]).push([[663],{253:function(){},3546:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return ve}});var l=o(4061),a=o(3992),n=o(3986);class r{static async getCategories(){const e=await n.A.get("/category/getcategories");return e}static async getTags(){const e=await n.A.get("/post/gettag");return e}static async getSeminars(){const e=await n.A.get("/seminar/getall");return e}static async writePost(e){const t=await n.A.post("/Post/write",e);return t}static async editPost(e){const t=await n.A.post("/Post/edit",e);return t}static async editPost(e){const t=await n.A.post("/Post/edit",e);return t}static async getPost(e){const t=await n.A.get(`/post/get/${e}`);return t}static async uploadWord(e){const t=new FormData;t.append("upload",e);const o=await n.A.post("/Upload/UploadWord",t,{headers:{"Content-Type":"multipart/form-data"}});return o}static async getRegions(e="Regions"){const t=await n.A.get(`/post/GetRegions?name=${e}`);return t}}var i=o(7695),s=o(4485),c=(o(4564),o(2532),{__name:"QTagInput",props:{modelValue:{type:Array,default:()=>[]},label:{type:String,default:""},outlined:{type:Boolean,default:!1},dense:{type:Boolean,default:!1},autogrow:{type:Boolean,default:!1},tagColors:{type:Array,default:()=>["#FFB300","#39B54A","#00A1E9","#F75000","#8C6E63","#E67E22"]},clearable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,a=t,n=(0,l.ref)(""),r=(0,l.ref)(null),i=(0,l.ref)(null),s=(0,l.computed)(()=>o.modelValue.length>0||n.value.length>0),c=(0,l.computed)(()=>({minHeight:o.dense?"40px":"56px",transition:"min-height 0.2s",overflow:"visible"})),d=(0,l.computed)(()=>({display:"flex",flexWrap:"wrap",alignItems:"center",gap:o.dense?"4px":"8px",minHeight:o.dense?"28px":"50px",padding:o.dense?"1px 4px":"8px 12px"})),u=(0,l.computed)(()=>({border:"none",outline:"none",fontSize:o.dense?"12px":"16px",background:"transparent",minWidth:o.dense?"30px":"50px",flexGrow:1,marginLeft:"2px",marginRight:"2px",height:o.dense?"20px":"24px",width:"50px"}));function p(e){const t=Math.abs(Array.from(e).reduce((e,t)=>e+t.charCodeAt(0),0))%o.tagColors.length;return o.tagColors[t]}function m(){const e=n.value.trim();e&&!o.modelValue.includes(e)&&a("update:modelValue",[...o.modelValue,e]),n.value=""}function v(e){const t=[...o.modelValue];t.splice(e,1),a("update:modelValue",t),(0,l.nextTick)(()=>{i.value&&i.value.focus()})}function V(){a("update:modelValue",[]),n.value="",(0,l.nextTick)(()=>{i.value&&i.value.focus()})}function f(e){"Enter"===e.key||","===e.key?(e.preventDefault(),m()):"Backspace"===e.key&&0===n.value.length&&o.modelValue.length>0&&v(o.modelValue.length-1)}function C(){i.value&&i.value.focus()}return(0,l.watch)(()=>o.modelValue.length,()=>{(0,l.nextTick)(()=>{r.value&&(r.value.parentElement.style.minHeight=Math.max(c.value.minHeight.replace("px",""),r.value.offsetHeight)+"px")})}),(t,o)=>{const a=(0,l.resolveComponent)("q-icon"),g=(0,l.resolveComponent)("q-field");return(0,l.openBlock)(),(0,l.createBlock)(g,{label:e.label,outlined:e.outlined,dense:e.dense,autogrow:e.autogrow,class:(0,l.normalizeClass)(["color-tag-input",{"color-tag-input--dense":e.dense},{"q-field--float":s.value}]),style:(0,l.normalizeStyle)(c.value),onClick:C},{default:(0,l.withCtx)(()=>[(0,l.createElementVNode)("div",{class:"tag-list",style:(0,l.normalizeStyle)(d.value),ref_key:"tagList",ref:r},[e.clearable&&e.modelValue.length?((0,l.openBlock)(),(0,l.createBlock)(a,{key:0,name:"clear",class:"clear-icon",onMousedown:o[0]||(o[0]=(0,l.withModifiers)(()=>{},["prevent"])),onClick:V})):(0,l.createCommentVNode)("",!0),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.modelValue,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)("span",{key:t,class:"tag",style:(0,l.normalizeStyle)({background:p(e)})},[(0,l.createTextVNode)((0,l.toDisplayString)(e)+" ",1),(0,l.createVNode)(a,{name:"close",class:"remove-icon",onClick:e=>v(t)},null,8,["onClick"])],4))),128)),(0,l.withDirectives)((0,l.createElementVNode)("input",{ref_key:"input",ref:i,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value=e),style:(0,l.normalizeStyle)(u.value),onKeydown:f,onBlur:m,class:"tag-input"},null,36),[[l.vModelText,n.value]])],4)]),_:1},8,["label","outlined","dense","autogrow","class","style"])}}}),d=o(1317),u=o(5855),p=o(4503),m=o(2110),v=o.n(m);const V=(0,d.A)(c,[["__scopeId","data-v-1e8250a2"]]);var f=V;v()(c,"components",{QField:u.A,QIcon:p.A});const C={key:0},g={key:1,class:"write-blog-container"},w={key:0,class:"text-h6"},h={key:1,class:"text-h6"},x={class:"row"},y={class:"row items-center"},N={key:0,class:"row items-center"},b={key:0},k={class:"row q-gutter-md"},E={class:"col"},A={class:"col"},R={class:"row q-mb-md"},B={class:"col"},D={class:"col"},S={class:"col"},_={class:"col"},q={class:"row"},I={class:"col-3"},U={class:"col-3"},T={class:"col"},L={class:"row items-center"},M={key:0,class:"col-3"},P={style:{"font-size":"14px"}},F={style:{"min-height":"420px"}},Q={class:"row",style:{"min-width":"600px"}},z={class:"row q-gutter-md"},O={class:"col"},$={key:0,class:"col"},W={key:1,class:"col"},Y={class:"row items-start"};var H=(0,l.defineComponent)({__name:"write",setup(e){const t=(0,s.k)(),o=(0,a.useRoute)(),n=(0,a.useRouter)(),c=(0,l.ref)(null),d=(0,l.ref)(null),u=(0,l.ref)(o.query.id>0),p=(0,l.reactive)({Id:o.query.id?Number(o.query.id):0,Title:"",Author:"",Email:"",Content:"",ProtectContent:"",ProtectContentMode:0,ProtectContentRegions:"",ProtectContentLimitMode:1,ProtectPassword:"",CategoryId:1,Labels:[],Keyword:"",Seminars:[],DisableCopy:!1,DisableComment:!1,schedule:!1,timespan:"",Redirect:"",IsNsfw:!1,ExpireAt:"",LimitMode:0,Regions:"",ExceptRegions:"",Reserve:!0}),m=(0,l.computed)({get(){return p.Keyword?p.Keyword.split(",").filter(e=>e.trim().length>0):[]},set(e){p.Keyword=e.join(",")}}),v=(0,l.ref)(!1),V=(0,l.ref)(!0),H=(0,l.ref)(!1),j=(0,l.ref)(!1),K=(0,l.ref)(!1),J=(0,l.ref)(null);let G=null;const X=(0,l.ref)([]),Z=(0,l.ref)([]),ee=(0,l.ref)([]),te=(0,l.ref)([]),oe=(0,l.ref)([]),le=(0,l.ref)([]),ae=(0,l.ref)([]),ne=(0,l.ref)([]),re=(0,l.ref)([]),ie=(0,l.ref)([]),se=[{label:"无加密",value:0},{label:"评论可见",value:1},{label:"地区可见",value:2},{label:"授权可见",value:3},{label:"密码可见",value:4},{label:"仅搜索引擎可见",value:5}],ce=[{label:"不限",value:0},{label:"指定地区可见",value:1},{label:"指定地区不可见",value:2},{label:"指定地区可见但排除在内的这些地区",value:3},{label:"指定地区不可见但排除在内的这些地区",value:4},{label:"仅搜索引擎可见",value:5}],de=async()=>{try{const e=await r.getCategories();e.Success&&(X.value=pe(e.Data)||[],Z.value=X.value)}catch(e){console.error("加载分类失败:",e),i.oR.error("加载分类失败",{position:"top-center",autoClose:3e3})}},ue=(e,t)=>{t(()=>{if(""===e)Z.value=X.value;else{const t=e.toLowerCase();Z.value=X.value.filter(e=>e.Name.toLowerCase().indexOf(t)>-1)}})},pe=(e,t="")=>{const o=[];for(const l of e){const e=t?`${t}/${l.Name}`:l.Name;if(o.push({...l,Name:e,OriginalName:l.Name}),l.Children&&l.Children.length>0){const t=pe(l.Children,e);o.push(...t)}}return o},me=async()=>{try{const e=await r.getTags();e.Success&&(ee.value=e.Data||[],te.value=ee.value)}catch(e){console.error("加载标签失败:",e),i.oR.error("加载标签失败",{position:"top-center",autoClose:3e3})}},ve=(e,t)=>{t(""!==e?()=>{const t=e?.toLowerCase();te.value=ee.value.filter(e=>e?.toLowerCase().indexOf(t)>-1)}:()=>{te.value=ee.value})},Ve=(e,t)=>{const o=ee.value.find(t=>t.TagName===e);if(!o&&e.length>0){const o={Id:Date.now(),TagName:e};ee.value.push(o),te.value=ee.value,t(e)}},fe=async()=>{const e=await r.getSeminars();e.Success&&(oe.value=e.Data||[],le.value=oe.value)},Ce=(e,t)=>{t(()=>{if(""===e)le.value=oe.value;else{const t=e.toLowerCase();le.value=oe.value.filter(e=>e.Title.toLowerCase().indexOf(t)>-1)}})},ge=async()=>{let e=await r.getRegions();e.Success&&(ae.value=e.Data||[],ne.value=ae.value),e=await r.getRegions("ExceptRegions"),e.Success&&(re.value=e.Data||[])},we=(e,t)=>{t(""!==e?()=>{const t=e?.toLowerCase();ne.value=ae.value.filter(e=>e?.toLowerCase().indexOf(t)>-1)}:()=>{ne.value=ae.value})},he=(e,t)=>{const o=ae.value.find(t=>t===e);!o&&e.length>0&&(ae.value.push(e),ne.value=ae.value,t(e))},xe=(e,t)=>{t(""!==e?()=>{const t=e?.toLowerCase();ie.value=re.value.filter(e=>e?.toLowerCase().indexOf(t)>-1)}:()=>{ie.value=re.value})},ye=(e,t)=>{const o=re.value.find(t=>t===e);!o&&e.length>0&&(re.value.push(e),ie.value=re.value,t(e))},Ne=()=>{j.value=!0},be=e=>{J.value=e},ke=async()=>{if(J.value){H.value=!0;try{const e=await r.uploadWord(J.value);e.Success?(p.Title=e.Data?.Title||p.Title,p.Content=e.Data?.Content||"",i.oR.success("Word文档上传成功",{position:"top-center",autoClose:3e3}),j.value=!1,J.value=null):i.oR.error(e.Message||"Word文档上传失败",{position:"top-center",autoClose:3e3})}catch(e){console.error("上传Word文档失败:",e),i.oR.error("上传失败，请重试",{position:"top-center",autoClose:3e3})}finally{H.value=!1}}else i.oR.error("请选择要上传的Word文档",{position:"top-center",autoClose:3e3})},Ee=async()=>{if(!p.Title||p.Title.trim().length<2)i.oR.error("文章标题至少需要2个字符",{position:"top-center",autoClose:3e3});else if(!p.Content||p.Content.length<20)i.oR.error("文章内容至少需要20个字符",{position:"top-center",autoClose:3e3});else{if(p.schedule&&p.timespan){const e=new Date(p.timespan),t=new Date;if(e<=t)return void i.oR.error("定时发表时间必须大于当前时间",{position:"top-center",autoClose:3e3})}else if(p.schedule&&!p.timespan)return void i.oR.error("请选择定时发表时间",{position:"top-center",autoClose:3e3});v.value=!0;try{p.Label=p.Labels.join(",");const e=u.value?await r.editPost(p):await r.writePost(p);e.Success?(i.oR.success("文章发布成功",{position:"top-center",autoClose:3e3}),localStorage.removeItem("write-post-draft:"+p.Id),clearInterval(G),n.push("/posts/list")):i.oR.error(e.Message||"文章发布失败",{position:"top-center",autoClose:3e3})}catch(e){console.error("提交文章失败:",e),i.oR.error("提交失败，请重试",{position:"top-center",autoClose:3e3})}finally{v.value=!1}}},Ae=()=>{const e=localStorage.getItem("write-post-draft:"+p.Id);if(e){const t=JSON.parse(e);Object.assign(p,t)}Re(),K.value=!1},Re=()=>{G=setInterval(()=>{const e={...p};localStorage.setItem("write-post-draft:"+p.Id,JSON.stringify(e))},5e3)},Be=e=>{const t=new Date,o=new Date(e);return o>=new Date(t.getFullYear(),t.getMonth(),t.getDate())},De=(e,t)=>{const o=new Date,l=new Date(o.getFullYear(),o.getMonth(),o.getDate());if(!p.timespan)return!0;const a=p.timespan.split(" ")[0];if(!a)return!0;const n=new Date(a);if(n.getTime()!==l.getTime())return!0;const r=o.getHours(),i=o.getMinutes();return void 0!==t?e>r||e===r&&t>i:e>=r},Se=async()=>{const e=new URLSearchParams(window.location.search),t=o.query.refer||o.query.id||e.get("refer");if(t){const e=await r.getPost(parseInt(t));if(e.Success&&e.Data){const t=e.Data;t.Id=o.query.id||0,t.Labels=t.Label?.split(",")||[],Object.assign(p,t)}}};(0,l.onMounted)(async()=>{const e=await t.getUserInfo();p.Author=e.NickName,p.Email=e.Email,await Promise.all([de(),me(),fe(),Se(),ge()]),K.value=JSON.parse(localStorage.getItem("write-post-draft:"+p.Id))?.Content?.length>0,K.value||Re(),document.querySelector(".q-page-container").addEventListener("scroll",Ue),V.value=!1}),(0,l.onUnmounted)(()=>{G&&clearInterval(G),_e&&clearTimeout(_e),document.querySelector(".q-page-container")?.removeEventListener("scroll",Ue)});let _e=null,qe=!1,Ie=!1;const Ue=()=>{_e&&clearTimeout(_e),_e=setTimeout(()=>{Te()},100)},Te=()=>{if(c.value?.$el){const e=c.value.$el.querySelector(".edui-editor-toolbarbox");if(e){const t=c.value.$el.getBoundingClientRect(),o=t.top<84&&t.bottom>300;if(o&&!qe){const t=c.value.$el.offsetWidth;e.style.cssText=`\n          position: fixed !important;\n          top: 84px !important;\n          z-index: 1000 !important;\n          width: ${t}px !important;\n          transition: all 0.5s ease !important;\n        `,qe=!0}else!o&&qe&&(e.style.cssText="\n          position: static !important;\n          top: auto !important;\n          z-index: auto !important;\n          width: auto !important;\n          transition: all 0.5s ease !important;\n        ",qe=!1)}}if(d.value?.$el){const e=d.value.$el.querySelector(".edui-editor-toolbarbox");if(e){const t=d.value.$el.getBoundingClientRect(),o=t.top<84&&t.bottom>300;if(o&&!Ie){const t=d.value.$el.offsetWidth;e.style.cssText=`\n          position: fixed !important;\n          top: 84px !important;\n          z-index: 1000 !important;\n          width: ${t}px !important;\n          transition: all 0.2s ease !important;\n        `,Ie=!0}else!o&&Ie&&(e.style.cssText="\n          position: static !important;\n          top: auto !important;\n          z-index: auto !important;\n          width: auto !important;\n          transition: all 0.2s ease !important;\n        ",Ie=!1)}}};return(e,t)=>{const a=(0,l.resolveComponent)("q-spinner"),n=(0,l.resolveComponent)("q-inner-loading"),r=(0,l.resolveComponent)("q-btn"),i=(0,l.resolveComponent)("q-input"),s=(0,l.resolveComponent)("vue-ueditor-wrap"),G=(0,l.resolveComponent)("q-card-section"),X=(0,l.resolveComponent)("q-card"),ee=(0,l.resolveComponent)("q-select"),oe=(0,l.resolveComponent)("q-item-section"),ae=(0,l.resolveComponent)("q-item"),re=(0,l.resolveComponent)("q-chip"),de=(0,l.resolveComponent)("q-date"),pe=(0,l.resolveComponent)("q-popup-proxy"),me=(0,l.resolveComponent)("q-icon"),fe=(0,l.resolveComponent)("q-checkbox"),ge=(0,l.resolveComponent)("q-time"),Se=(0,l.resolveComponent)("q-file"),_e=(0,l.resolveComponent)("q-card-actions"),qe=(0,l.resolveComponent)("q-dialog"),Ie=(0,l.resolveDirective)("close-popup");return V.value?((0,l.openBlock)(),(0,l.createElementBlock)("div",C,[(0,l.createVNode)(n,{showing:V.value},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(a,{color:"primary",size:"100px"})]),_:1},8,["showing"])])):((0,l.openBlock)(),(0,l.createElementBlock)("div",g,[(0,l.unref)(o).query.id?((0,l.openBlock)(),(0,l.createElementBlock)("div",w,"编辑ID："+(0,l.toDisplayString)(p.Id),1)):(0,l.createCommentVNode)("",!0),(0,l.unref)(o).query.refer?((0,l.openBlock)(),(0,l.createElementBlock)("div",h,"复制来源ID："+(0,l.toDisplayString)((0,l.unref)(o).query.refer),1)):(0,l.createCommentVNode)("",!0),(0,l.createElementVNode)("div",x,[(0,l.createVNode)(i,{autogrow:"",class:"col",modelValue:p.Title,"onUpdate:modelValue":t[0]||(t[0]=e=>p.Title=e),label:"文章标题",outlined:"",required:"",rules:[e=>!!e||"请输入文章标题",e=>e.length>=2||"标题至少2个字符",e=>e.length<=128||"标题最多128个字符"],style:{"font-size":"23px"}},{append:(0,l.withCtx)(()=>[(0,l.createVNode)(r,{dense:"",size:"lg",color:"info",label:"上传Word文档",onClick:Ne,class:"full-width",icon:"upload","no-caps":""})]),_:1},8,["modelValue","rules"])]),(0,l.createVNode)(X,{flat:"",bordered:"",class:"q-mb-md"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(G,null,{default:(0,l.withCtx)(()=>[t[35]||(t[35]=(0,l.createElementVNode)("div",{class:"text-h6"},"文章内容：",-1)),(0,l.createVNode)(s,{ref_key:"editor",ref:c,modelValue:p.Content,"onUpdate:modelValue":t[1]||(t[1]=e=>p.Content=e),config:{initialFrameHeight:500}},null,8,["modelValue"])]),_:1})]),_:1}),(0,l.createVNode)(X,{flat:"",bordered:"",class:"q-mb-md"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(G,null,{default:(0,l.withCtx)(()=>[(0,l.createElementVNode)("div",y,[(0,l.createVNode)(ee,{dense:"",modelValue:p.ProtectContentMode,"onUpdate:modelValue":t[2]||(t[2]=e=>p.ProtectContentMode=e),options:se,label:"加密模式",outlined:"",style:{"min-width":"200px"},"map-options":"","emit-value":""},{before:(0,l.withCtx)(()=>[...t[36]||(t[36]=[(0,l.createElementVNode)("div",{class:"text-h6"},"文章加密内容",-1)])]),_:1},8,["modelValue"]),2===p.ProtectContentMode?((0,l.openBlock)(),(0,l.createElementBlock)("div",N,[(0,l.createVNode)(i,{autogrow:"",dense:"",modelValue:p.ProtectContentRegions,"onUpdate:modelValue":t[4]||(t[4]=e=>p.ProtectContentRegions=e),label:"可见地区","shadow-text":"竖线分隔，支持国家、地区、城市、运营商、ASN",style:{width:"450px"},outlined:""},{append:(0,l.withCtx)(()=>[(0,l.createVNode)(ee,{dense:"",borderless:"",modelValue:p.ProtectContentLimitMode,"onUpdate:modelValue":t[3]||(t[3]=e=>p.ProtectContentLimitMode=e),options:[{label:"以内",value:1},{label:"以外",value:2}],"emit-value":"","map-options":""},null,8,["modelValue"])]),_:1},8,["modelValue"])])):(0,l.createCommentVNode)("",!0),4===p.ProtectContentMode?((0,l.openBlock)(),(0,l.createBlock)(i,{key:1,autogrow:"",dense:"",modelValue:p.ProtectPassword,"onUpdate:modelValue":t[5]||(t[5]=e=>p.ProtectPassword=e),label:"访问密码",type:"password",outlined:""},null,8,["modelValue"])):(0,l.createCommentVNode)("",!0)]),p.ProtectContentMode>0?((0,l.openBlock)(),(0,l.createElementBlock)("div",b,[(0,l.createVNode)(s,{ref_key:"protectContentEditor",ref:d,modelValue:p.ProtectContent,"onUpdate:modelValue":t[6]||(t[6]=e=>p.ProtectContent=e),config:{initialFrameHeight:300}},null,8,["modelValue"])])):(0,l.createCommentVNode)("",!0)]),_:1})]),_:1}),(0,l.createVNode)(X,{flat:"",bordered:"",class:"q-mb-md"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(G,null,{default:(0,l.withCtx)(()=>[t[37]||(t[37]=(0,l.createElementVNode)("div",{class:"text-h6"},"作者信息",-1)),(0,l.createElementVNode)("div",k,[(0,l.createElementVNode)("div",E,[(0,l.createVNode)(i,{autogrow:"",dense:"",modelValue:p.Author,"onUpdate:modelValue":t[7]||(t[7]=e=>p.Author=e),label:"作者",outlined:"",rules:[e=>!!e||"请输入作者",e=>e.length<=20||"作者名最多20个字符"]},null,8,["modelValue","rules"])]),(0,l.createElementVNode)("div",A,[(0,l.createVNode)(i,{autogrow:"",dense:"",modelValue:p.Email,"onUpdate:modelValue":t[8]||(t[8]=e=>p.Email=e),label:"邮箱",type:"email",outlined:"",rules:[e=>!!e||"请输入邮箱",e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"邮箱格式不正确"]},null,8,["modelValue","rules"])])])]),_:1})]),_:1}),(0,l.createVNode)(X,{flat:"",bordered:"",class:"q-mb-md"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(G,null,{default:(0,l.withCtx)(()=>[t[40]||(t[40]=(0,l.createElementVNode)("div",{class:"text-h6"},"文章设置",-1)),(0,l.createElementVNode)("div",R,[(0,l.createElementVNode)("div",B,[(0,l.createVNode)(ee,{dense:"",modelValue:p.CategoryId,"onUpdate:modelValue":t[9]||(t[9]=e=>p.CategoryId=e),options:Z.value,label:"分类",outlined:"","option-label":"Name","option-value":"Id","emit-value":"","map-options":"","use-input":"","input-debounce":"300",onFilter:ue},{"no-option":(0,l.withCtx)(()=>[(0,l.createVNode)(ae,null,{default:(0,l.withCtx)(()=>[(0,l.createVNode)(oe,{class:"text-grey"},{default:(0,l.withCtx)(()=>[...t[38]||(t[38]=[(0,l.createTextVNode)(" 没有找到匹配的分类 ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),(0,l.createElementVNode)("div",D,[(0,l.createVNode)(ee,{dense:"",modelValue:p.Seminars,"onUpdate:modelValue":t[10]||(t[10]=e=>p.Seminars=e),options:le.value,label:"专题",outlined:"",multiple:"","use-chips":"","option-label":"Title","option-value":"Id","map-options":"","emit-value":"","use-input":"","input-debounce":"300",onFilter:Ce,clearable:""},{"no-option":(0,l.withCtx)(()=>[(0,l.createVNode)(ae,null,{default:(0,l.withCtx)(()=>[(0,l.createVNode)(oe,{class:"text-grey"},{default:(0,l.withCtx)(()=>[...t[39]||(t[39]=[(0,l.createTextVNode)(" 没有找到匹配的专题 ",-1)])]),_:1})]),_:1})]),"selected-item":(0,l.withCtx)(e=>[(0,l.createVNode)(re,{style:(0,l.normalizeStyle)({backgroundColor:["#FFB300","#39B54A","#00A1E9","#F75000","#8C6E63","#E67E22"][e.index%6],color:"white",fontSize:"11px"}),removable:"",onRemove:t=>e.removeAtIndex(e.index)},{default:(0,l.withCtx)(()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.opt.Title),1)]),_:2},1032,["style","onRemove"])]),_:1},8,["modelValue","options"])]),(0,l.createElementVNode)("div",S,[(0,l.createVNode)(ee,{dense:"",modelValue:p.Labels,"onUpdate:modelValue":t[11]||(t[11]=e=>p.Labels=e),options:te.value,label:"标签",outlined:"",multiple:"","use-chips":"","use-input":"","new-value-mode":"add-unique","input-debounce":"0",onFilter:ve,onNewValue:Ve,clearable:""},{"selected-item":(0,l.withCtx)(e=>[(0,l.createVNode)(re,{style:(0,l.normalizeStyle)({backgroundColor:["#FFB300","#39B54A","#00A1E9","#F75000","#8C6E63","#E67E22"][e.index%6],color:"white",fontSize:"11px"}),removable:"",onRemove:t=>e.removeAtIndex(e.index)},{default:(0,l.withCtx)(()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.opt),1)]),_:2},1032,["style","onRemove"])]),_:1},8,["modelValue","options"])]),(0,l.createElementVNode)("div",_,[(0,l.createVNode)(f,{clearable:"",dense:"",autogrow:"",modelValue:m.value,"onUpdate:modelValue":t[12]||(t[12]=e=>m.value=e),label:"文章关键词",outlined:""},null,8,["modelValue"])])]),(0,l.createElementVNode)("div",q,[(0,l.createElementVNode)("div",I,[(0,l.createVNode)(i,{dense:"",autogrow:"",modelValue:p.Redirect,"onUpdate:modelValue":t[13]||(t[13]=e=>p.Redirect=e),label:"跳转到第三方链接","shadow-text":"如：https://baidu.com 留空不跳转",outlined:"",hint:"当跳转第三方链接时，文章内容不宜过多"},null,8,["modelValue"])]),(0,l.createElementVNode)("div",U,[(0,l.createVNode)(i,{dense:"",modelValue:p.ExpireAt,"onUpdate:modelValue":t[16]||(t[16]=e=>p.ExpireAt=e),label:"过期时间",outlined:"",readonly:""},{append:(0,l.withCtx)(()=>[(0,l.createVNode)(me,{name:"event",class:"cursor-pointer"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(pe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,l.withCtx)(()=>[(0,l.withDirectives)((0,l.createVNode)(de,{modelValue:p.ExpireAt,"onUpdate:modelValue":t[14]||(t[14]=e=>p.ExpireAt=e),options:Be,mask:"YYYY-MM-DD"},null,8,["modelValue"]),[[Ie]])]),_:1})]),_:1}),p.ExpireAt?((0,l.openBlock)(),(0,l.createBlock)(r,{key:0,round:"",flat:"",icon:"clear",onClick:t[15]||(t[15]=e=>p.ExpireAt="")})):(0,l.createCommentVNode)("",!0)]),_:1},8,["modelValue"])]),(0,l.createElementVNode)("div",T,[(0,l.createElementVNode)("div",L,[(0,l.createVNode)(fe,{modelValue:p.IsNsfw,"onUpdate:modelValue":t[17]||(t[17]=e=>p.IsNsfw=e),label:"标记为不安全的内容"},null,8,["modelValue"]),u.value?((0,l.openBlock)(),(0,l.createBlock)(fe,{key:0,modelValue:p.Reserve,"onUpdate:modelValue":t[18]||(t[18]=e=>p.Reserve=e),label:"保留历史版本"},null,8,["modelValue"])):(0,l.createCommentVNode)("",!0),(0,l.createVNode)(fe,{modelValue:p.DisableCopy,"onUpdate:modelValue":t[19]||(t[19]=e=>p.DisableCopy=e),label:"禁止转载"},null,8,["modelValue"]),(0,l.createVNode)(fe,{modelValue:p.DisableComment,"onUpdate:modelValue":t[20]||(t[20]=e=>p.DisableComment=e),label:"禁止评论"},null,8,["modelValue"]),u.value||p.schedule?(0,l.createCommentVNode)("",!0):((0,l.openBlock)(),(0,l.createBlock)(fe,{key:1,modelValue:p.schedule,"onUpdate:modelValue":t[21]||(t[21]=e=>p.schedule=e),label:"定时发表"},null,8,["modelValue"]))])]),p.schedule?((0,l.openBlock)(),(0,l.createElementBlock)("div",M,[(0,l.createVNode)(i,{dense:"",modelValue:p.timespan,"onUpdate:modelValue":t[26]||(t[26]=e=>p.timespan=e),label:"计划发表时间",outlined:"",readonly:""},{prepend:(0,l.withCtx)(()=>[(0,l.createElementVNode)("span",P,[u.value?(0,l.createCommentVNode)("",!0):((0,l.openBlock)(),(0,l.createBlock)(fe,{key:0,modelValue:p.schedule,"onUpdate:modelValue":t[22]||(t[22]=e=>p.schedule=e),label:"定时发表"},null,8,["modelValue"]))])]),append:(0,l.withCtx)(()=>[(0,l.createVNode)(me,{name:"event",class:"cursor-pointer"},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(pe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,l.withCtx)(()=>[(0,l.createElementVNode)("div",F,[(0,l.createElementVNode)("div",Q,[(0,l.createVNode)(de,{modelValue:p.timespan,"onUpdate:modelValue":t[23]||(t[23]=e=>p.timespan=e),mask:"YYYY-MM-DD HH:mm",options:Be},null,8,["modelValue"]),p.timespan?((0,l.openBlock)(),(0,l.createBlock)(ge,{key:0,modelValue:p.timespan,"onUpdate:modelValue":t[24]||(t[24]=e=>p.timespan=e),mask:"YYYY-MM-DD HH:mm",options:De},null,8,["modelValue"])):(0,l.createCommentVNode)("",!0)]),p.timespan?(0,l.withDirectives)(((0,l.openBlock)(),(0,l.createBlock)(r,{key:0,color:"primary",label:"确认"},null,512)),[[Ie]]):(0,l.createCommentVNode)("",!0)])]),_:1})]),_:1}),p.timespan?((0,l.openBlock)(),(0,l.createBlock)(r,{key:0,round:"",flat:"",icon:"clear",onClick:t[25]||(t[25]=e=>p.timespan="")})):(0,l.createCommentVNode)("",!0)]),_:1},8,["modelValue"])])):(0,l.createCommentVNode)("",!0)]),(0,l.createElementVNode)("div",z,[(0,l.createElementVNode)("div",O,[(0,l.createVNode)(ee,{dense:"",modelValue:p.LimitMode,"onUpdate:modelValue":t[27]||(t[27]=e=>p.LimitMode=e),options:ce,label:"文章地区投放",outlined:"","map-options":"","emit-value":""},null,8,["modelValue"])]),p.LimitMode>0&&p.LimitMode<5?((0,l.openBlock)(),(0,l.createElementBlock)("div",$,[(0,l.createVNode)(ee,{dense:"",modelValue:p.Regions,"onUpdate:modelValue":t[29]||(t[29]=e=>p.Regions=e),options:ne.value,label:p.LimitMode%2===1?"可见地区":"不可见地区","label-color":p.LimitMode%2===1?"":"red",outlined:"","use-input":"","new-value-mode":"add-unique","input-debounce":"0",onFilter:we,onNewValue:he,hint:"竖线分隔，如：江苏|苏州|移动|AS2333|DMIT，支持地区、运营商、ASN、机房名称"},{append:(0,l.withCtx)(()=>[p.Regions?((0,l.openBlock)(),(0,l.createBlock)(r,{key:0,round:"",flat:"",icon:"clear",onClick:t[28]||(t[28]=e=>p.Regions=null)})):(0,l.createCommentVNode)("",!0)]),_:1},8,["modelValue","options","label","label-color"])])):(0,l.createCommentVNode)("",!0),3===p.LimitMode||4===p.LimitMode?((0,l.openBlock)(),(0,l.createElementBlock)("div",W,[(0,l.createVNode)(ee,{dense:"",modelValue:p.ExceptRegions,"onUpdate:modelValue":t[31]||(t[31]=e=>p.ExceptRegions=e),options:ie.value,label:"排除地区",outlined:"","use-input":"","new-value-mode":"add-unique","input-debounce":"0",onFilter:xe,onNewValue:ye,hint:"竖线分隔，如：江苏|苏州|移动|AS2333|DMIT，支持地区、运营商、ASN、机房名称"},{append:(0,l.withCtx)(()=>[p.ExceptRegions?((0,l.openBlock)(),(0,l.createBlock)(r,{key:0,round:"",flat:"",icon:"clear",onClick:t[30]||(t[30]=e=>p.ExceptRegions=null)})):(0,l.createCommentVNode)("",!0)]),_:1},8,["modelValue","options"])])):(0,l.createCommentVNode)("",!0),(0,l.createElementVNode)("div",Y,[(0,l.createVNode)(r,{icon:"send",type:"submit",color:"primary",label:"发布文章",loading:v.value,onClick:Ee},null,8,["loading"])])])]),_:1})]),_:1}),(0,l.createVNode)(qe,{modelValue:j.value,"onUpdate:modelValue":t[33]||(t[33]=e=>j.value=e)},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(X,{style:{"min-width":"400px"}},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(G,null,{default:(0,l.withCtx)(()=>[...t[41]||(t[41]=[(0,l.createElementVNode)("div",{class:"text-h6"},"上传Word文档",-1),(0,l.createElementVNode)("div",{class:"text-caption text-orange"},"注意：重复上传将会覆盖之前上传的内容！",-1)])]),_:1}),(0,l.createVNode)(G,null,{default:(0,l.withCtx)(()=>[(0,l.createVNode)(Se,{modelValue:J.value,"onUpdate:modelValue":t[32]||(t[32]=e=>J.value=e),label:"选择Word文档",outlined:"",accept:".doc,.docx",onInput:be},{prepend:(0,l.withCtx)(()=>[(0,l.createVNode)(me,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1}),(0,l.createVNode)(_e,{align:"right"},{default:(0,l.withCtx)(()=>[(0,l.withDirectives)((0,l.createVNode)(r,{flat:"",label:"取消",color:"grey"},null,512),[[Ie]]),(0,l.createVNode)(r,{label:"上传",color:"primary",onClick:ke,loading:H.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.createVNode)(qe,{modelValue:K.value,"onUpdate:modelValue":t[34]||(t[34]=e=>K.value=e)},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(X,{style:{"min-width":"400px"}},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(G,null,{default:(0,l.withCtx)(()=>[...t[42]||(t[42]=[(0,l.createElementVNode)("div",{class:"text-h6"},"检测到草稿",-1),(0,l.createElementVNode)("div",{class:"text-caption text-orange"},"检查到上次有未提交的草稿，是否加载？",-1)])]),_:1}),(0,l.createVNode)(_e,{align:"right"},{default:(0,l.withCtx)(()=>[(0,l.withDirectives)((0,l.createVNode)(r,{flat:"",label:"取消",color:"grey",onClick:Re},null,512),[[Ie]]),(0,l.createVNode)(r,{label:"加载",color:"primary",onClick:Ae})]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.createVNode)(n,{showing:v.value},{default:(0,l.withCtx)(()=>[(0,l.createVNode)(a,{color:"primary",size:"100px"})]),_:1},8,["showing"])]))}}}),j=o(9010),K=o(5485),J=o(8622),G=o(407),X=o(3663),Z=o(7180),ee=o(975),te=o(5740),oe=o(1484),le=o(7491),ae=o(4854),ne=o(9341),re=o(8495),ie=o(7139),se=o(1375),ce=o(1929),de=o(1248),ue=o(6284),pe=o(515);const me=(0,d.A)(H,[["__scopeId","data-v-0f8bb56e"]]);var ve=me;v()(H,"components",{QInnerLoading:j.A,QSpinner:K.A,QInput:J.A,QBtn:G.A,QCard:X.A,QCardSection:Z.A,QSelect:ee.A,QItem:te.A,QItemSection:oe.A,QChip:le.A,QIcon:p.A,QPopupProxy:ae.A,QDate:ne.A,QCheckbox:re.A,QTime:ie.A,QDialog:se.A,QFile:ce.A,QCardActions:de.A,QPageContainer:ue.A}),v()(H,"directives",{ClosePopup:pe.A})},3986:function(e,t,o){"use strict";var l=o(3719),a=o.n(l),n=o(7454),r=o.n(n),i=o(6661),s=o(7695);const c=a().create({baseURL:i.c.baseURL,timeout:i.c.timeOut});c.interceptors.request.use(e=>{const t=sessionStorage.getItem("access_token");if(t&&(e.headers.Authorization="Bearer "+t),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=r().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),c.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&s.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return s.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:s.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:s.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:s.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:s.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:s.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:s.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:s.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:s.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:s.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:s.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),t.A=c},4485:function(e,t,o){"use strict";o.d(t,{k:function(){return i}});var l=o(3986),a=o(6661),n=o(36),r=o(4061);const i=(0,n.defineStore)("user",()=>{const e=(0,r.ref)(),t=(0,r.ref)(!1),o=async()=>{if(e.value)return e.value;try{const o=await l.A.get("/passport/getuserinfo");if(o.Data)return e.value=o.Data,t.value=!0,o.Data;window.location.href=a.A.baseURL+"/passport/login?redirect="+encodeURIComponent(window.location.pathname)}catch(o){throw console.error("获取用户信息失败:",o),e.value=null,t.value=!1,o}},n=o=>{e.value=o,t.value=!0},i=()=>{e.value=null,t.value=!1},s=()=>t.value&&null!==e.value;return{getUserInfo:o,setUserInfo:n,clearUserInfo:i,checkLoginStatus:s}})}}]);