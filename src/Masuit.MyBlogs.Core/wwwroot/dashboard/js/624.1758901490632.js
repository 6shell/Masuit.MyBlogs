(self["webpackChunkcimo"]=self["webpackChunkcimo"]||[]).push([[624],{13986:function(e,a,l){"use strict";var o=l(74413),t=l(27454),s=l.n(t),r=l(76661),n=l(57695);const i=o.A.create({baseURL:r.c.baseURL,timeout:r.c.timeOut});i.interceptors.request.use(e=>{const a=sessionStorage.getItem("access_token");if(a&&(e.headers.Authorization="Bearer "+a),e.type)switch(e.type){case"FORM-DATA":e.transformRequest=[e=>"args="+JSON.stringify(e)];break;case"FORM":e.headers["Content-Type"]="application/x-www-form-urlencoded",e.data=s().stringify(e.data);break;default:break}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>("object"==typeof e.data&&Object.keys(e.data).includes("Success")&&!0!==e.data.Success&&n.oR.error(e.data.Message||`请求失败:${e.request.responseURL}`,{autoClose:3e3,position:"top-center"}),e.data),e=>{if("ECONNABORTED"===e.code||e.message&&-1!==e.message.indexOf("timeout")||"Network Error"===e.message)return n.oR.error("网络异常",{autoClose:3e3,position:"top-center"}),Promise.reject(e);if(e.response)switch(e.response.status){case 400:n.oR.error("请求错误:"+e.response.data.Message||0,{autoClose:3e3,position:"top-center"});break;case 403:n.oR.error("拒绝访问(403)",{autoClose:3e3,position:"top-center"});break;case 404:n.oR.error("资源不存在(404)",{autoClose:3e3,position:"top-center"});break;case 408:n.oR.error("请求超时(408)",{autoClose:3e3,position:"top-center"});break;case 500:n.oR.error("服务器错误(500)",{autoClose:3e3,position:"top-center"});break;case 501:n.oR.error("服务未实现(501)",{autoClose:3e3,position:"top-center"});break;case 502:n.oR.error("网络错误(502)",{autoClose:3e3,position:"top-center"});break;case 503:n.oR.error("服务不可用(503)",{autoClose:3e3,position:"top-center"});break;case 504:n.oR.error("网络超时(504)",{autoClose:3e3,position:"top-center"});break;case 505:n.oR.error("HTTP版本不受支持(505)",{autoClose:3e3,position:"top-center"});break;default:break}return Promise.reject(e)}),a.A=i},42634:function(){},42999:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return z}});var o=l(74220),t=l(46732),s=l(97700),r=l(57695),n=l(13986),i=l(76661);const u={class:"user-list-container"},c={class:"row"},d={class:"col"},p={class:"col-2 text-right"},m=["src"],b={class:"text-subtitle2"},v={class:"q-mt-md flex justify-center items-center"},k={class:"text-h6"},g={class:"row justify-end q-gutter-sm"},f={class:"q-mb-md"},F={class:"row justify-end q-gutter-sm"};var A=(0,o.pM)({__name:"index",setup(e){const a=(0,t.KR)(!1),l=(0,t.KR)(!1),A=(0,t.KR)(!1),C=(0,t.KR)(!1),w=(0,t.KR)([]),R=(0,t.KR)(""),h=(0,t.KR)({page:1,rowsPerPage:10,total:0}),y=(0,t.KR)(!1),_=(0,t.KR)(!1),V=(0,t.KR)({Username:"",Email:"",NickName:"",Avatar:"",IsAdmin:!1}),q=(0,t.KR)(null),U=(0,t.KR)(null),x=(0,t.KR)(""),P=async()=>{a.value=!0;try{const e={page:h.value.page,size:h.value.rowsPerPage,search:R.value||""},a=await n.A.get("/user/getusers",{params:e});a&&(w.value=a.Data||[],h.value.total=a.TotalCount||0)}catch(e){r.oR.error("加载数据失败",{autoClose:2e3,position:"top-center"})}finally{a.value=!1}},Q=()=>{h.value.page=1,P()},L=(e=null)=>{V.value=e?{...e}:{Username:"",Email:"",NickName:"",Avatar:"",IsAdmin:!1},y.value=!0},N=()=>{y.value=!1,V.value={Username:"",Email:"",NickName:"",Avatar:"",IsAdmin:!1}},I=async()=>{l.value=!0;try{const e=await n.A.post("/user/save",V.value);e?.Success?(r.oR.success(e.Message||"保存成功",{autoClose:2e3,position:"top-center"}),N(),await P()):r.oR.error(e?.Message||"保存失败",{autoClose:2e3,position:"top-center"})}catch(e){r.oR.error("保存失败",{autoClose:2e3,position:"top-center"})}finally{l.value=!1}},K=async()=>{A.value=!0;const e=await n.A.post(`/user/delete?id=${q.value.Id}`);r.oR.success(e?.Message||"删除成功",{autoClose:2e3,position:"top-center"}),await P(),A.value=!1},M=e=>{U.value=e,x.value="",_.value=!0},E=()=>{_.value=!1,U.value=null,x.value=""},S=async()=>{C.value=!0;try{const e=await n.A.post("/user/ResetPassword",{name:U.value?.Username,pwd:x.value});e?.Success?(r.oR.success(e.Message||"密码重置成功",{autoClose:2e3,position:"top-center"}),E()):r.oR.error(e?.Message||"密码重置失败",{autoClose:2e3,position:"top-center"})}catch(e){r.oR.error("密码重置失败",{autoClose:2e3,position:"top-center"})}finally{C.value=!1}};return(0,o.sV)(()=>{P()}),(e,r)=>{const n=(0,o.g2)("q-btn"),j=(0,o.g2)("q-btn-group"),O=(0,o.g2)("q-icon"),T=(0,o.g2)("q-input"),W=(0,o.g2)("q-avatar"),z=(0,o.g2)("vxe-column"),B=(0,o.g2)("q-chip"),D=(0,o.g2)("q-tooltip"),X=(0,o.g2)("q-card-section"),$=(0,o.g2)("q-card-actions"),G=(0,o.g2)("q-card"),H=(0,o.g2)("q-popup-proxy"),J=(0,o.g2)("vxe-table"),Y=(0,o.g2)("q-pagination"),Z=(0,o.g2)("q-select"),ee=(0,o.g2)("q-space"),ae=(0,o.g2)("q-toggle"),le=(0,o.g2)("q-dialog"),oe=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)("div",u,[(0,o.bF)(G,null,{default:(0,o.k6)(()=>[(0,o.bF)(X,null,{default:(0,o.k6)(()=>[(0,o.Lk)("div",c,[(0,o.Lk)("div",d,[(0,o.bF)(j,{push:""},{default:(0,o.k6)(()=>[(0,o.bF)(n,{dense:"",color:"primary",icon:"add",onClick:r[0]||(r[0]=e=>L())},{default:(0,o.k6)(()=>[...r[11]||(r[11]=[(0,o.eW)(" 添加用户 ",-1)])]),_:1}),(0,o.bF)(n,{dense:"",color:"info",icon:"refresh",onClick:P,loading:a.value},{default:(0,o.k6)(()=>[...r[12]||(r[12]=[(0,o.eW)(" 刷新 ",-1)])]),_:1},8,["loading"])]),_:1})]),(0,o.Lk)("div",p,[(0,o.bF)(T,{modelValue:R.value,"onUpdate:modelValue":[r[1]||(r[1]=e=>R.value=e),P],placeholder:"全局搜索",outlined:"",dense:"",clearable:"",class:"search-input",debounce:"500"},{prepend:(0,o.k6)(()=>[(0,o.bF)(O,{name:"search"})]),_:1},8,["modelValue"])])]),(0,o.bF)(J,{data:w.value,loading:a.value,stripe:"",border:""},{default:(0,o.k6)(()=>[(0,o.bF)(z,{field:"Avatar",title:"头像",width:"80",fixed:"left"},{default:(0,o.k6)(({row:e})=>[e.Avatar?((0,o.uX)(),(0,o.Wv)(W,{key:0,size:"40px"},{default:(0,o.k6)(()=>[(0,o.Lk)("img",{src:e.Avatar?.startsWith("http")?e.Avatar:(0,t.R1)(i.A).baseURL+e.Avatar},null,8,m)]),_:2},1024)):(0,o.Q3)("",!0)]),_:1}),(0,o.bF)(z,{field:"Username",title:"用户名","min-width":"120"}),(0,o.bF)(z,{field:"Email",title:"用户邮箱","min-width":"200"}),(0,o.bF)(z,{field:"NickName",title:"昵称","min-width":"120"}),(0,o.bF)(z,{field:"IsAdmin",title:"是否管理员",width:"120"},{default:(0,o.k6)(({row:e})=>[(0,o.bF)(B,{color:e.IsAdmin?"positive":"grey","text-color":"white",label:e.IsAdmin?"管理员":"普通用户",size:"sm"},null,8,["color","label"])]),_:1}),(0,o.bF)(z,{title:"操作",width:"180",fixed:"right"},{default:(0,o.k6)(({row:e})=>[(0,o.bF)(n,{dense:"",flat:"",color:"primary",icon:"edit",onClick:a=>L(e)},{default:(0,o.k6)(()=>[(0,o.bF)(D,null,{default:(0,o.k6)(()=>[...r[13]||(r[13]=[(0,o.eW)("编辑",-1)])]),_:1})]),_:1},8,["onClick"]),(0,o.bF)(n,{dense:"",flat:"",color:"negative",icon:"delete"},{default:(0,o.k6)(()=>[(0,o.bF)(D,null,{default:(0,o.k6)(()=>[...r[14]||(r[14]=[(0,o.eW)("删除",-1)])]),_:1}),(0,o.bF)(H,{"transition-show":"scale","transition-hide":"scale"},{default:(0,o.k6)(()=>[(0,o.bF)(G,null,{default:(0,o.k6)(()=>[(0,o.bF)(X,{class:"row items-center"},{default:(0,o.k6)(()=>[(0,o.bF)(O,{name:"warning",color:"red",size:"2rem",class:"q-mr-sm"}),(0,o.Lk)("div",null,[r[15]||(r[15]=(0,o.Lk)("div",{class:"text-h6"},"确认删除",-1)),(0,o.Lk)("div",b,"确认删除用户【"+(0,s.v_)(e.Username)+"】吗？",1)])]),_:2},1024),(0,o.bF)($,{align:"right"},{default:(0,o.k6)(()=>[(0,o.bo)((0,o.bF)(n,{flat:"",label:"确认",color:"negative",onClick:a=>{q.value=e,K()},loading:A.value},null,8,["onClick","loading"]),[[oe]]),(0,o.bo)((0,o.bF)(n,{flat:"",label:"取消",color:"primary"},null,512),[[oe]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),(0,o.bF)(n,{dense:"",flat:"",color:"warning",icon:"lock_reset",onClick:a=>M(e)},{default:(0,o.k6)(()=>[(0,o.bF)(D,null,{default:(0,o.k6)(()=>[...r[16]||(r[16]=[(0,o.eW)("重置密码",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","loading"]),(0,o.Lk)("div",v,[(0,o.bF)(Y,{modelValue:h.value.page,"onUpdate:modelValue":[r[2]||(r[2]=e=>h.value.page=e),P],max:Math.ceil(h.value.total/h.value.rowsPerPage),"direction-links":""},null,8,["modelValue","max"]),(0,o.bF)(Z,{outlined:"",modelValue:h.value.rowsPerPage,"onUpdate:modelValue":[r[3]||(r[3]=e=>h.value.rowsPerPage=e),Q],options:[10,15,20,30,50,100,200],dense:"",label:"每页"},null,8,["modelValue"])])]),_:1})]),_:1}),(0,o.bF)(le,{modelValue:y.value,"onUpdate:modelValue":r[8]||(r[8]=e=>y.value=e),persistent:""},{default:(0,o.k6)(()=>[(0,o.bF)(G,{style:{"min-width":"500px"}},{default:(0,o.k6)(()=>[(0,o.bF)(X,{class:"row items-center q-pb-none"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",k,(0,s.v_)(V.value?.Id?"编辑用户":"添加用户"),1),(0,o.bF)(ee),(0,o.bF)(n,{icon:"close",flat:"",round:"",dense:"",onClick:N})]),_:1}),(0,o.bF)(X,null,{default:(0,o.k6)(()=>[(0,o.bF)(T,{modelValue:V.value.Username,"onUpdate:modelValue":r[4]||(r[4]=e=>V.value.Username=e),label:"用户名",outlined:"",rules:[e=>!!e||"请输入用户名"]},null,8,["modelValue","rules"]),(0,o.bF)(T,{modelValue:V.value.NickName,"onUpdate:modelValue":r[5]||(r[5]=e=>V.value.NickName=e),label:"用户昵称",outlined:"",rules:[e=>!!e||"请输入用户昵称"]},null,8,["modelValue","rules"]),(0,o.bF)(T,{modelValue:V.value.Email,"onUpdate:modelValue":r[6]||(r[6]=e=>V.value.Email=e),label:"用户邮箱",outlined:"",type:"email",rules:[e=>!!e||"请输入用户邮箱",e=>/.+@.+\..+/.test(e)||"请输入正确的邮箱格式"]},null,8,["modelValue","rules"]),(0,o.bF)(ae,{modelValue:V.value.IsAdmin,"onUpdate:modelValue":r[7]||(r[7]=e=>V.value.IsAdmin=e),label:"管理员权限",color:"primary"},null,8,["modelValue"]),(0,o.Lk)("div",g,[(0,o.bF)(n,{label:"取消",color:"grey",onClick:N}),(0,o.bF)(n,{label:"保存",type:"submit",color:"primary",loading:l.value,onClick:I},null,8,["loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,o.bF)(le,{modelValue:_.value,"onUpdate:modelValue":r[10]||(r[10]=e=>_.value=e),persistent:""},{default:(0,o.k6)(()=>[(0,o.bF)(G,{style:{"min-width":"400px"}},{default:(0,o.k6)(()=>[(0,o.bF)(X,{class:"row items-center q-pb-none"},{default:(0,o.k6)(()=>[r[17]||(r[17]=(0,o.Lk)("div",{class:"text-h6"},"重置密码",-1)),(0,o.bF)(ee),(0,o.bF)(n,{icon:"close",flat:"",round:"",dense:"",onClick:E})]),_:1}),(0,o.bF)(X,null,{default:(0,o.k6)(()=>[(0,o.Lk)("div",f,[(0,o.Lk)("strong",null,"用户："+(0,s.v_)(U.value?.Username),1)]),(0,o.bF)(T,{modelValue:x.value,"onUpdate:modelValue":r[9]||(r[9]=e=>x.value=e),label:"新密码",outlined:"",type:"password",rules:[e=>!!e||"请输入新密码",e=>e.length>=6||"密码长度至少6位"]},null,8,["modelValue","rules"]),(0,o.Lk)("div",F,[(0,o.bF)(n,{label:"取消",color:"grey",onClick:E}),(0,o.bF)(n,{label:"确定",type:"submit",color:"primary",loading:C.value,onClick:S},null,8,["loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),C=l(1317),w=l(63663),R=l(17180),h=l(10258),y=l(20407),_=l(38622),V=l(64503),q=l(85515),U=l(97491),x=l(76997),P=l(34854),Q=l(71248),L=l(74183),N=l(40975),I=l(51375),K=l(25915),M=l(91343),E=l(45855),S=l(93483),j=l(60515),O=l(22110),T=l.n(O);const W=(0,C.A)(A,[["__scopeId","data-v-e177b6cc"]]);var z=W;T()(A,"components",{QCard:w.A,QCardSection:R.A,QBtnGroup:h.A,QBtn:y.A,QInput:_.A,QIcon:V.A,QAvatar:q.A,QChip:U.A,QTooltip:x.A,QPopupProxy:P.A,QCardActions:Q.A,QPagination:L.A,QSelect:N.A,QDialog:I.A,QSpace:K.A,QToggle:M.A,QField:E.A,QForm:S.A}),T()(A,"directives",{ClosePopup:j.A})}}]);