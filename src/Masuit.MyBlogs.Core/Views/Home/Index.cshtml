@using System.Diagnostics
@using Collections.Pooled
@using Masuit.MyBlogs.Core.Common
@using Masuit.MyBlogs.Core.Models.DTO
@using Masuit.MyBlogs.Core.Models.Entity
@using Masuit.MyBlogs.Core.Models.ViewModel
@using Masuit.Tools
@using Masuit.Tools.Core.Net
@using Microsoft.AspNetCore.Http
@model Masuit.MyBlogs.Core.Models.ViewModel.HomePageViewModel
@{
  ViewBag.Title = "首页";
  Layout = "~/Views/Shared/_Layout.cshtml";
  PooledList<FastShare> shares = ViewBag.FastShare;
  Context.Request.Path = new PathString("/posts");
}
<link href="~/Assets/banner/carousel.css" rel="stylesheet"/>
@if (Model.Banner.Any()) {
  <div class="carousel" id="@SnowFlake.NewId">
    @for (int i = 0; i < Model.Banner.Count; i++) {
      if (i == 0) {
        <div class="active carousel-slide fade-in">
          <a href="@Model.Banner[i].Url" target="_blank" title="@Model.Banner[i].Title">
            <img alt="@(i + 1)" src="@Model.Banner[i].ImageUrl">
          </a>
        </div>
      } else {
        <div class="carousel-slide">
          <a href="@Model.Banner[i].Url" target="_blank" title="@Model.Banner[i].Title">
            <img alt="@(i + 1)" src="@Model.Banner[i].ImageUrl">
          </a>
        </div>
      }
    }
    <button class="carousel-btn left">&#9664;</button>
    <button class="carousel-btn right">&#9654;</button>
    <div class="carousel-indicator"></div>
  </div>
}
<br/>
@if (Model.Notices.Any()) {
  <div class="container notice">
    <a asp-action="Details" asp-controller="Notice" asp-route-id="@(Model.Notices[0].Id)">
      <h3 class="size18 text-center text-red">网站最新公告</h3>
    </a>
    @Html.Raw(Model.Notices[0].Content.Replace("img src=", $"img class='lazyload' title='{CommonHelper.SystemSettings["Title"]}' alt='{CommonHelper.SystemSettings["Title"]}' decoding='async' loading='lazy' data-src="))
  </div>
}
@if (shares.Any()) {
  <div class="container padding-clear">
    <div class="panel panel-info">
      <div class="panel-heading">⚡小撇步Tips⚡</div>
      <div class="padding-clear panel-body">
        <table class="margin-clear table table-bordered">
          @for (int i = 1; i < shares.Count + 1; i += 2) {
            if (i < shares.Count) {
              <tr>
                @if (string.IsNullOrEmpty(shares[i - 1].Link)) {
                  <td style="width: 50%">▸ @shares[i - 1].Title</td>
                } else {
                  <td style="width: 50%">
                    ▸
                    <a href="@shares[i - 1].Link" target="_blank">@shares[i - 1].Title</a>
                  </td>
                }
                @if (string.IsNullOrEmpty(shares[i].Link)) {
                  <td style="width: 50%">▸ @shares[i].Title</td>
                } else {
                  <td style="width: 50%">
                    ▸
                    <a href="@shares[i].Link" target="_blank">@shares[i].Title</a>
                  </td>
                }
              </tr>
            } else {
              if (string.IsNullOrEmpty(shares[i - 1].Link)) {
                <tr>
                  <td colspan="2">▸ @shares[i - 1].Title</td>
                </tr>
              } else {
                <tr>
                  <td colspan="2">
                    ▸
                    <a href="@shares[i - 1].Link" target="_blank">@shares[i - 1].Title</a>
                  </td>
                </tr>
              }
            }
          }
        </table>
      </div>
    </div>
  </div>
}
@{
  var user = Context.Session.Get<UserInfoDto>(SessionKey.UserInfo) ?? new UserInfoDto();
  await Html.RenderPartialAsync(user.IsAdmin ? "_MainContainer_Admin" : "_MainContainer", Model);
}
<script src="~/Assets/banner/carousel.js"></script>