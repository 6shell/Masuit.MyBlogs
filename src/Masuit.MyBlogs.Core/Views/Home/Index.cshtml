@using System.Diagnostics
@using Collections.Pooled
@using Masuit.MyBlogs.Core.Common
@using Masuit.MyBlogs.Core.Models.DTO
@using Masuit.MyBlogs.Core.Models.Entity
@using Masuit.MyBlogs.Core.Models.ViewModel
@using Masuit.Tools
@using Masuit.Tools.Core.Net
@using Microsoft.AspNetCore.Http
@model Masuit.MyBlogs.Core.Models.ViewModel.HomePageViewModel
@{
  ViewBag.Title = "首页";
  Layout = "~/Views/Shared/_Layout.cshtml";
  PooledList<FastShare> shares = ViewBag.FastShare;
  Context.Request.Path = new PathString("/posts");
}
<link href="~/Assets/banner/carousel.css" rel="stylesheet"/>
@if (Model.Banner.Any()) {
  <div class="carousel" id="@SnowFlake.NewId">
    @for (int i = 0; i < Model.Banner.Count; i++) {
      if (i == 0) {
        <div class="active carousel-slide fade-in">
          <a href="@Model.Banner[i].Url" target="_blank" title="@Model.Banner[i].Title">
            <img alt="@(i + 1)" src="@Model.Banner[i].ImageUrl">
          </a>
        </div>
      } else {
        <div class="carousel-slide">
          <a href="@Model.Banner[i].Url" target="_blank" title="@Model.Banner[i].Title">
            <img alt="@(i + 1)" src="@Model.Banner[i].ImageUrl">
          </a>
        </div>
      }
    }
    <button class="carousel-btn left">&#9664;</button>
    <button class="carousel-btn right">&#9654;</button>
    <div class="carousel-indicator"></div>
  </div>
}
<br/>
@if (Model.Notices.Any()) {
  <div class="list-container">
    <div class="site-announcement-bar">
      <div class="announcement-container">
        <div class="announcement-header">
          <span class="announcement-title">【公告】@Model.Notices[0].Title</span>
          <span class="announcement-time">@Model.Notices[0].ModifyDate.ToString("yyyy-MM-dd")</span>
        </div>
        <div class="announcement-content">
          @Html.Raw(Model.Notices[0].Content.Replace("img src=", $"img class='lazyload' title='{CommonHelper.SystemSettings["Title"]}' alt='{CommonHelper.SystemSettings["Title"]}' decoding='async' loading='lazy' data-src="))
        </div>
      </div>
    </div>
  </div>
}
@if (shares.Any()) {
  <div class="list-container">
    <div class="site-tips-bar">
      <div class="site-tips-title">⚡小撇步Tips⚡</div>
      <ul class="site-tips-list">
        @foreach (var share in shares) {
          <li class="site-tip-item">
            @if (!string.IsNullOrEmpty(share.Link)) {
              <a href="@share.Link" target="_blank">▸ @share.Title</a>
              <a href="@share.Link" target="_blank">🔗</a>
            } else {
              <text>▸ @share.Title</text>
            }
          </li>
        }
      </ul>
    </div>
  </div>
}
@{
  var user = Context.Session.Get<UserInfoDto>(SessionKey.UserInfo) ?? new UserInfoDto();
  await Html.RenderPartialAsync(user.IsAdmin ? "_MainContainer_Admin" : "_MainContainer", Model);
}
<script src="~/Assets/banner/carousel.js"></script>