@model string
@using Masuit.MyBlogs.Core.Models.DTO
@{
    ViewBag.Title = "网站打赏";
    Layout = "~/Views/Shared/_Layout.cshtml";
    Random r = new Random();
    List<AdvertisementDto> ads = ViewBag.Ads;
}
<style>
    .bg-title {
        height: 50vh;
        max-height: 400px;
        position: relative;
        background: url(/Content/images/@(r.Next(1, 9)).jpg) no-repeat center;
        background-size: cover;
        background-attachment: fixed;
    }

    .flex-box {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
        height: 100%;
    }

        .flex-box > div {
            margin: 0 15px;
            width: 18%;
        }

    @@media only screen and (max-width: 1080px) {
        .flex-box > div {
            width: 29.8%;
        }
    }
</style>
<ol class="cd-breadcrumb triangle">
    <li>
        <a asp-action="Index" asp-controller="Home">首页</a>
    </li>
    <li class="current">
        <em>@ViewBag.Title</em>
    </li>
</ol>
<div class="bg-title">
    <div class="header-content text-center">
        <h2 class="size48">
            喜欢我的作品和文章？
        </h2>
        <div class="divider"></div>
        <p class="size24">
            您的捐助就是给我最大的鼓励
        </p>
    </div>
</div>
@Html.Raw(Model)
<div class="container-fluid" id="donateApp" ng-controller="home as list">
    <div class="margin-clear page-header">
        <h2 class="size24" style="display: inline">
            打赏名单(排名不分先后)：
        </h2>
    </div>
    <vxe-table :data="tableData" :loading="loading" border stripe>
        <!-- 打赏时间列 -->
        <vxe-column field="DonateTime" formatter="formatDate" title="打赏时间" width="160"></vxe-column>
        <!-- 昵称列 -->
        <vxe-column field="NickName" min-width="140" title="昵称"></vxe-column>
        <!-- 金额列 -->
        <vxe-column field="Amount" title="金额" width="110"></vxe-column>
        <!-- 打赏方式列 -->
        <vxe-column field="Via" title="打赏方式" width="140"></vxe-column>
        <!-- Email列 -->
        <vxe-column field="Email" min-width="200" title="Email"></vxe-column>
        <!-- QQ或微信列 -->
        <vxe-column field="QQorWechat" title="QQ或微信" width="160"></vxe-column>
    </vxe-table>
    <!-- 分页组件 -->
    <vxe-pager :current-page="pageConfig.page" :page-size="pageConfig.size" :total="pageConfig.total" @@page-change="pageChange" />
</div>
@if (ads.Count == 2)
{
    <div class="container-fluid">
        <div class="margin-clear page-header">
            <h2 class="size24" style="display: inline">
                推广支持：
            </h2>
        </div>
        <div class="row">
            <div class="col-md-6">
                @{
                    await Html.RenderPartialAsync("_ArticleListAdvertisement", ads[0]);
                }
            </div>
            <div class="col-md-6">
                @{
                    await Html.RenderPartialAsync("_ArticleListAdvertisement", ads[1]);
                }
            </div>
        </div>
    </div>
}
<link href="https://cdn.jsdelivr.net/npm/vxe-pc-ui@4.9.25/lib/style.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/vxe-table@4.16.11/lib/style.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xe-utils/dist/xe-utils.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vxe-pc-ui@4.9.25/lib/index.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vxe-table@4.16.11/lib/index.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@6/dist/echarts.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs/dayjs.min.js"></script>
<script>
    VxeUI.formats.add('formatDate', {
      cellFormatMethod:function (data, format) {
        return dayjs(data.cellValue).format(format || 'YYYY-MM-DD')
      }
    })
    const { createApp, ref, onMounted, watch, computed } = Vue;
    createApp({
        setup() {
            // 表格数据
            const tableData = ref([]);

            // 分页配置
            const pageConfig = ref({
                page: 1,
                size: 10,
                total: 0
            });

            // 加载状态
            const loading = ref(false);
            return {
                tableData,
                pageConfig,
                loading
            };
        },
        methods: {
          pageChange({ pageSize, currentPage }) {
              this.pageConfig.page = currentPage;
              this.pageConfig.size = pageSize;
              this.loadData();
          },
          async loadData(){
            this.loading = true;
            const data = await axios.post(`/DonateList?page=${this.pageConfig.page}&size=${this.pageConfig.size}`).then(res=>res.data);
            this.tableData = data.Data;
            this.pageConfig.total = data.TotalCount;
            this.loading = false;
          }},
        created() {
            this.loadData();
        }
    }).use(VxeUI).use(VXETable).mount('#donateApp');

</script>